<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <!-- CSS Bundles - Phase 2 Optimization -->
  <link rel="stylesheet" href="/assets/css-bundles-dist/core.bundle.css">
  <link rel="stylesheet" href="/assets/css-bundles-dist/layout.bundle.css">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://wesh360.ir/amaayesh/">
  <meta property="og:title" content="نقشه آمایش انرژی خراسان رضوی">
  <meta property="og:description" content="پتانسیل باد، خورشید و آب استان">
  <meta property="og:image" content="https://wesh360.ir/page/landing/logo2.webp">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="نقشه آمایش انرژی خراسان رضوی">
  <meta name="twitter:description" content="پتانسیل باد، خورشید و آب استان">
  <meta name="twitter:image" content="https://wesh360.ir/page/landing/logo2.webp">
  <title>نقشه آمایش انرژی خراسان رضوی - پتانسیل باد، خورشید و آب | WESH360</title>
  <meta name="description" content="نقشه تعاملی آمایش انرژی خراسان رضوی - بررسی پتانسیل انرژی بادی، خورشیدی، سدها و منابع آب استان برای برنامه‌ریزی انرژی">
  <link rel="canonical" href="https://wesh360.ir/amaayesh/">
  <link rel="icon" type="image/svg+xml" href="/assets/img/logo/wesh360.svg"/>
  <link rel="alternate icon" type="image/png" sizes="32x32" href="/assets/img/logo/icons/icon-32.png"/>
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/logo/icons/icon-180.png"/>
  <link rel="manifest" href="/manifest.webmanifest"/>
  <link rel="mask-icon" href="/assets/img/logo/wesh360.svg" color="#0ea5e9"/>
  <meta name="theme-color" content="#0ea5e9"/>
  <link rel="stylesheet" href="../assets/vendor/leaflet/leaflet.css" />
  <link rel="stylesheet" href="/assets/css/map-overrides.css" />
  <link rel="stylesheet" href="../assets/legend.css"/>
  <link rel="stylesheet" href="/assets/css/map-inline.css" />
  <script src="/assets/js/nav-utils.js" defer></script>
  <meta name="build-id" content="ama-20250906">
  <script>
    /* Suppress Cloudflare Beacon Errors */
    window.addEventListener('error',function(e){if(e.target&&e.target.src&&(e.target.src.includes('statsfa.com')||e.target.src.includes('beacon.min.js'))){e.preventDefault();e.stopPropagation();return false;}},true);

    /* Responsive Mobile Detection */
    (function() {
      function updateMobileClass() {
        const main = document.querySelector('.ama-main');
        if (!main) return;

        if (window.innerWidth <= 768) {
          main.classList.add('is-mobile');
        } else {
          main.classList.remove('is-mobile');
        }
      }

      // Initial check
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', updateMobileClass);
      } else {
        updateMobileClass();
      }

      // Update on resize with debounce
      let resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(updateMobileClass, 250);
      });
    })();

    /* Mobile Sidebar Management */
    (function() {
      function initMobileSidebar() {
        const menuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('mobile-sidebar');
        const overlay = document.getElementById('mobile-sidebar-overlay');
        const closeBtn = document.getElementById('mobile-sidebar-close');
        const panelsContainer = document.getElementById('mobile-panels-container');
        const layerDock = document.getElementById('ama-layer-dock');
        const topDock = document.getElementById('ama-top-dock');

        if (!menuBtn || !sidebar || !overlay) return;

        let isMobile = false;

        function checkMobile() {
          const wasMobile = isMobile;
          isMobile = window.innerWidth <= 768;

          if (isMobile && !wasMobile) {
            // Switched to mobile - move panels to sidebar
            if (layerDock && !panelsContainer.contains(layerDock)) {
              panelsContainer.appendChild(layerDock);
            }
            if (topDock && !panelsContainer.contains(topDock)) {
              panelsContainer.appendChild(topDock);
            }
          } else if (!isMobile && wasMobile) {
            // Switched to desktop - move panels back
            const main = document.querySelector('.ama-main');
            if (layerDock && panelsContainer.contains(layerDock)) {
              main.appendChild(layerDock);
            }
            if (topDock && panelsContainer.contains(topDock)) {
              main.appendChild(topDock);
            }
            closeSidebar();
          }
        }

        function openSidebar() {
          sidebar.classList.add('open');
          overlay.classList.add('active');
          menuBtn.classList.add('active');
          sidebar.setAttribute('aria-hidden', 'false');
          overlay.setAttribute('aria-hidden', 'false');
          menuBtn.setAttribute('aria-expanded', 'true');
          document.body.style.overflow = 'hidden';
        }

        function closeSidebar() {
          sidebar.classList.remove('open');
          overlay.classList.remove('active');
          menuBtn.classList.remove('active');
          sidebar.setAttribute('aria-hidden', 'true');
          overlay.setAttribute('aria-hidden', 'true');
          menuBtn.setAttribute('aria-expanded', 'false');
          document.body.style.overflow = '';
        }

        function toggleSidebar() {
          if (sidebar.classList.contains('open')) {
            closeSidebar();
          } else {
            openSidebar();
          }
        }

        // Event listeners
        menuBtn.addEventListener('click', toggleSidebar);
        closeBtn?.addEventListener('click', closeSidebar);
        overlay.addEventListener('click', closeSidebar);

        // Close on Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape' && sidebar.classList.contains('open')) {
            closeSidebar();
          }
        });

        // Handle resize
        checkMobile();
        let resizeTimer;
        window.addEventListener('resize', function() {
          clearTimeout(resizeTimer);
          resizeTimer = setTimeout(checkMobile, 250);
        });
      }

      // Initialize after DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initMobileSidebar);
      } else {
        initMobileSidebar();
      }
    })();
  </script>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100 flex flex-col">
  <a class="skip-link" href="#main">پرش به محتوای اصلی</a>

<main id="main" role="main" class="flex relative ama-main">
    <!-- Hamburger Menu Button (Mobile Only) -->
    <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="منو" aria-expanded="false">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>

    <!-- Mobile Sidebar -->
    <aside id="mobile-sidebar" class="mobile-sidebar" aria-hidden="true">
      <div class="mobile-sidebar-header">
        <h2 class="mobile-sidebar-title">منو</h2>
        <button id="mobile-sidebar-close" class="mobile-sidebar-close" aria-label="بستن منو">×</button>
      </div>
      <div class="mobile-sidebar-content">
        <!-- Panels will be moved here in mobile -->
        <div id="mobile-panels-container"></div>
      </div>
    </aside>

    <!-- Sidebar Overlay -->
    <div id="mobile-sidebar-overlay" class="mobile-sidebar-overlay" aria-hidden="true"></div>

    <!-- ظرف نقشه: id باید «map» بماند -->
    <div id="map"></div>

    <!-- پنل سمت راست -->
    <aside id="ama-layer-dock" class="ama-panel map-panel ama-layer-dock">
      <div class="ama-panel-header">
        <h2 class="ama-panel-title">لایه‌ها</h2>
        <button aria-label="تنظیمات" class="ama-settings-btn">⚙️</button>
      </div>
      <div class="ama-tabs">
        <button id="tab-wind"  data-layer-toggle="wind"  class="ama-tab-btn ama-tab-active">باد</button>
        <button id="tab-solar" data-layer-toggle="solar" class="ama-tab-btn ama-tab-inactive">خورشیدی</button>
        <button id="tab-dams"  data-layer-toggle="dams"  class="ama-tab-btn ama-tab-inactive">آب</button>
      </div>
      <div class="ama-checkbox-grid">
        <label data-layer-toggle="wind"><input type="checkbox"> سایت‌های بادی (انرژی)</label>
        <label data-layer-toggle="solar"><input type="checkbox"> سایت‌های خورشیدی</label>
        <label data-layer-toggle="dams"><input type="checkbox"> سد</label>
      </div>
    </aside>

    <!-- پنل سمت چپ -->
    <aside id="ama-top-dock" class="ama-panel map-panel ama-top-dock">
      <div class="ama-panel-header">
        <h2 class="ama-panel-title">برترین‌ها</h2>
        <span class="ama-top-badge">Top 10</span>
      </div>
      <table class="ama-top-table">
        <thead class="ama-top-thead">
          <tr><th class="ama-top-th">رتبه</th><th class="ama-top-th">شهرسان</th><th class="ama-top-th">پتانسیل (MW)</th></tr>
        </thead>
        <tbody id="ama-top10"></tbody>
      </table>
    </aside>
  </main>

  <footer class="mt-6 py-6 text-center text-slate-400 text-xs">WESH360 ⬢ Energy Spatial Planning ⬢ Leaflet</footer>

  <!-- supercluster optional (CDN removed due to CSP). Use local vendor if added. -->
  <script defer src="/assets/vendor/leaflet/leaflet.js"></script>
  <script defer src="/assets/js/leaflet-icon-patch.js"></script>
  <script defer src="/assets/vendor/leaflet.polylineDecorator.min.js"></script>
  <script type="module" src="/assets/js/amaayesh-map.js"></script>
  <script defer src="/assets/js/panel-direct-wire.js"></script>
  <script defer src="/assets/js/ama-diag.js"></script>
  <script defer src="/assets/js/amaayesh-ui-enhancements.js"></script>
  <script>
    (function(){
      const mapEl = document.getElementById('map');
      if (!mapEl || typeof ResizeObserver === 'undefined') return;
      const ensureMapRef = () => {
        if (!window.myLeafletMap && window.__AMA_MAP && typeof window.__AMA_MAP.invalidateSize === 'function') {
          window.myLeafletMap = window.__AMA_MAP;
        }
        window.myLeafletMap?.invalidateSize();
      };
      ensureMapRef();
      new ResizeObserver(ensureMapRef).observe(mapEl);
    })();
  </script>
  <script defer src="/assets/js/ui-prune-ctas.js"></script>
  <script src="/assets/js/header.js" defer></script>
  <script src="/assets/js/nav-prune.js" defer></script>
  <!-- Statsfa Website Analytics Start -->
  <script data-host="https://statsfa.com" data-dnt="true" src="https://statsfa.com/js/script.js" id="ZwSg9rf6GA" async defer></script>
  <!-- Statsfa Website Analytics End -->
  <!-- دکمه ثبت بازخورد Porsline -->
  <a class="porsline-button-wrapper" href="#porsline-side-tab"
    onclick="clzdTiLuIp('porsline-side-tab-iframe');showSideTab()">
    بازخورد دهید
  </a>
  <script>
    // Load Porsline script immediately with async for better performance
    (function() {
      try {
        var js,q,d=document,
          gi=d.getElementById,
          ce=d.createElement,
          gt=d.getElementsByTagName,
          id="porsline-share",
          b="https://cdn.porsline.ir/static/panel/v2/statics/";
        if(!gi.call(d,id)) {
          js=ce.call(d,"script");
          js.id = id;
          js.setAttribute("data-position","right");
          js.src=b+"side-tab.js";
          js.async = true;
          js.onerror = function() {
            console.warn('Porsline script failed to load');
          };
          q=gt.call(d,"script")[0];
          q.parentNode.insertBefore(js,q);
        }
      } catch(e) {
        console.warn('Porsline initialization error:', e.message);
      }
    })();

    var clzdTiLuIp = function (ifid) {
      try {
        const el = document.getElementById(ifid);
        if (el) {
          el.fetchPriority = 'high';
          el.src = "https://survey.porsline.ir/s/zdTiLuIp#/?ac=0&ns=0";
        }
      } catch(e) {
        console.warn('Porsline iframe error:', e.message);
      }
    };
  </script>
</body>
</html>
