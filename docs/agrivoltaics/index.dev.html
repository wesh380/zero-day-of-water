<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ ÙÙˆØªÙˆÚ©ÙØ´Øª â€“ wesh360</title>
  <!-- React 18 UMD + ReactDOM  -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel Ø¨Ø±Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒ JSX Ø¯Ø± Ù…Ø±ÙˆØ±Ú¯Ø± (ÙÙ‚Ø· Ø¬Ù‡Øª Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø³Ø±ÛŒØ¹Ø› Ø¨Ø±Ø§ÛŒ Ù†Ø³Ø®Ù‡ Ù†Ù‡Ø§ÛŒÛŒ Ø¨Ù‡ØªØ± Ø§Ø³Øª Ø¨ÛŒÙ„Ø¯ Ú©Ù†ÛŒØ¯) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="stylesheet" href="../assets/tailwind.css">
  <link rel="stylesheet" href="/assets/unified-badge.css">
  <link rel="stylesheet" href="/assets/global-footer.css">
  <link rel="stylesheet" href="../assets/site-overrides.css">
  <script defer src="/assets/unified-badge.js"></script>
  <script defer src="/assets/global-footer.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;

    // Ù†Ø³Ø®Ù‡ Ù…Ø®ØµÙˆØµ Ø§Ø³ØªØ§Ù† Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ (Ø³Ø§Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ú©Ø´Ø§ÙˆØ±Ø²Ø§Ù†)
    // Ù†Ú©ØªÙ‡: Ø§Ø¹Ø¯Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ ØªÙ‚Ø±ÛŒØ¨ÛŒ Ù‡Ø³ØªÙ†Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø´Ø±Ø§ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ Ø²Ù…ÛŒÙ† Ø®ÙˆØ¯ØªØ§Ù† ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.

    // Ø§Ø¬Ø²Ø§ÛŒ Ú©Ù…Ú©ÛŒ Ø³Ø§Ø¯Ù‡
    const Section = ({ title, children }) => (
      <section className="bg-neutral-950/60 border border-neutral-800 rounded-2xl p-4 md:p-6 shadow-xl">
        <h2 className="text-emerald-400 text-base md:text-lg font-bold mb-3">{title}</h2>
        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">{children}</div>
      </section>
    );

    const NumberInput = ({ label, value, onChange, step = 1 }) => (
      <label className="flex flex-col gap-1 text-sm">
        <span className="text-gray-200">{label}</span>
        <input dir="ltr" type="number" step={step} value={value}
          onChange={(e)=>onChange(Number(e.target.value))}
          className="w-full rounded-xl bg-neutral-900 border border-neutral-700 px-3 py-2 text-right text-gray-100 focus:outline-none focus:ring-2 focus:ring-emerald-500" />
      </label>
    );

    const Select = ({ label, value, onChange, options }) => (
      <label className="flex flex-col gap-1 text-sm">
        <span className="text-gray-200">{label}</span>
        <select value={value} onChange={(e)=>onChange(e.target.value)}
          className="w-full rounded-xl bg-neutral-900 border border-neutral-700 px-3 py-2 text-right text-gray-100">
          {options.map(o=> <option key={o.value} value={o.value}>{o.label}</option>)}
        </select>
      </label>
    );

    const KPI = ({ title, value, sub }) => (
      <div className="rounded-2xl bg-neutral-950/60 border border-neutral-800 p-4 shadow-xl">
        <div className="text-gray-300 text-sm">{title}</div>
        <div className="text-xl md:text-2xl font-extrabold mt-1 text-emerald-400">{value}</div>
        {sub && <div className="text-xs text-gray-400 mt-1">{sub}</div>}
      </div>
    );

      const KV = ({ k, v }) => (
        <div className="rounded-xl bg-neutral-900/50 border border-neutral-800 p-3">
          <div className="text-gray-400 text-xs">{k}</div>
          <div className="text-sm md:text-base font-semibold text-gray-100 mt-0.5">{v}</div>
        </div>
      );

      async function saveScenario(state) {
        const { apiFetch } = await import('/assets/js/api.js');
        const res = await apiFetch("/api/save-scenario", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ state })
        });
        const { id } = await res.json();
        const share = `${location.origin}${location.pathname}?id=${encodeURIComponent(id)}`;
        alert("Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯! Ø§ÛŒÙ† Ù„ÛŒÙ†Ú© Ø±Ø§ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒØ¯:\n" + share);
      }

      async function loadScenarioIfAny(setState) {
        const id = new URLSearchParams(location.search).get("id");
        if (!id) return;
        const { apiFetch } = await import('/assets/js/api.js');
        const res = await apiFetch(`/api/get-scenario?id=${encodeURIComponent(id)}`);
        const saved = await res.json();
        if (saved) setState(saved);
      }

      function AgrivoltaicsKhorasan(){
        const [simple, setSimple] = useState(true);

      // Ù…Ù†Ø·Ù‚Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø±ØªÚ©Ø±Ø§Ø± Ø§Ø³ØªØ§Ù† (ØªÙ‚Ø±ÛŒØ¨ÛŒ)
      const regions = {
        mashhad: { title: "Ø¯Ø´Øª Ù…Ø´Ù‡Ø¯ / Ú†Ù†Ø§Ø±Ø§Ù†", sun: 1675, heat: "med" },
        neyshabur: { title: "Ù†ÛŒØ´Ø§Ø¨ÙˆØ± / ÙÛŒØ±ÙˆØ²Ù‡", sun: 1680, heat: "med" },
        torbat: { title: "ØªØ±Ø¨Øªâ€ŒØ­ÛŒØ¯Ø±ÛŒÙ‡ / Ø²Ø§ÙˆÙ‡ / Ù…Ù‡â€ŒÙˆÙ„Ø§Øª / Ú¯Ù†Ø§Ø¨Ø§Ø¯", sun: 1800, heat: "high" },
        sabzevar: { title: "Ø³Ø¨Ø²ÙˆØ§Ø± / Ø¨Ø±Ø¯Ø³Ú©Ù† / Ú©Ø§Ø´Ù…Ø±", sun: 1750, heat: "high" },
        quchan: { title: "Ù‚ÙˆÚ†Ø§Ù† / Ø¯Ø±Ú¯Ø² / Ú©Ù„Ø§Øª", sun: 1625, heat: "low" },
        torbat_jam: { title: "ØªØ±Ø¨Øªâ€ŒØ¬Ù… / ØªØ§ÛŒØ¨Ø§Ø¯ / ÙØ±ÛŒÙ…Ø§Ù† / Ø®ÙˆØ§Ù", sun: 1780, heat: "high" },
      };

      // Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ÛŒØ¬
      const cropProfiles = {
        "Ø²Ø¹ÙØ±Ø§Ù†": { baseYieldChange: 6, waterSaving: -28, price_per_t: 2000000000, yield_t_ha: 4 },
        "Ú¯Ù†Ø¯Ù…": { baseYieldChange: -2, waterSaving: -10, price_per_t: 500000000, yield_t_ha: 5.5 },
        "Ø¬Ùˆ": { baseYieldChange: -3, waterSaving: -10, price_per_t: 420000000, yield_t_ha: 4.5 },
        "Ù¾Ø³ØªÙ‡": { baseYieldChange: -3, waterSaving: -20, price_per_t: 1800000000, yield_t_ha: 1.0 },
        "Ø§Ù†Ú¯ÙˆØ±": { baseYieldChange: 1, waterSaving: -15, price_per_t: 250000000, yield_t_ha: 20 },
        "Ø³Ø¨Ø²ÛŒØ¬Ø§Øª Ø¨Ø±Ú¯ÛŒ": { baseYieldChange: 8, waterSaving: -30, price_per_t: 250000000, yield_t_ha: 20 },
        "Ø·Ø§Ù„Ø¨ÛŒ/Ø®Ø±Ø¨Ø²Ù‡": { baseYieldChange: 2, waterSaving: -20, price_per_t: 180000000, yield_t_ha: 15 },
      };

      // Ø¢Ø¨ Ùˆ Ø®Ø§Ú©
      const waterSources = {
        well_electric_subsidized: { title: "Ú†Ø§Ù‡ â€“ Ø¨Ø±Ù‚ ÛŒØ§Ø±Ø§Ù†Ù‡â€ŒØ§ÛŒ", elec_tariff: 1000, water_cost: 0 },
        well_electric_normal: { title: "Ú†Ø§Ù‡ â€“ Ø¨Ø±Ù‚ Ù…Ø¹Ù…ÙˆÙ„ÛŒ", elec_tariff: 3000, water_cost: 0 },
        well_diesel: { title: "Ú†Ø§Ù‡ â€“ Ø¯ÛŒØ²Ù„ÛŒ", elec_tariff: 6000, water_cost: 0 },
        qanat: { title: "Ù‚Ù†Ø§Øª / Ø¢Ø¨ Ø«Ù‚Ù„ÛŒ", elec_tariff: 0, water_cost: 5000 },
        canal: { title: "Ú©Ø§Ù†Ø§Ù„/Ø´Ø¨Ú©Ù‡ Ø¢Ø¨ÛŒØ§Ø±ÛŒ", elec_tariff: 0, water_cost: 20000 },
      };
      const dustLevels = { low: { title: "Ú¯Ø±Ø¯ Ùˆ ØºØ¨Ø§Ø± Ú©Ù…", soiling: 3 }, med: { title: "Ú¯Ø±Ø¯ Ùˆ ØºØ¨Ø§Ø± Ù…ØªÙˆØ³Ø·", soiling: 5 }, high: { title: "Ú¯Ø±Ø¯ Ùˆ ØºØ¨Ø§Ø± Ø²ÛŒØ§Ø¯", soiling: 8 } };
      const soils = { sandy: { title: "Ø´Ù†ÛŒ", pump_kWh_m3: 0.45 }, loam: { title: "Ù„ÙˆÙ… (Ù…ÛŒØ§Ù†â€ŒØ¯Ø§Ù†Ù‡)", pump_kWh_m3: 0.5 }, clay: { title: "Ø±Ø³ÛŒ", pump_kWh_m3: 0.55 } };

      // ÙˆØ¶Ø¹ÛŒØª ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
        const [s, setS] = useState({
        region: "torbat",
        crop_type: "Ø²Ø¹ÙØ±Ø§Ù†",
        water_source: "well_electric_subsidized",
        dust_level: "med",
        soil_type: "loam",
        salinity_EC: 3,
        project_area_ha: 1,
        time_horizon_years: 25,
        discount_rate_pct: 12,
        currency: "Ø±ÛŒØ§Ù„",
        baseline_yield_t_per_ha: cropProfiles["Ø²Ø¹ÙØ±Ø§Ù†"].yield_t_ha,
        expected_yield_change_pct_under_AGV: cropProfiles["Ø²Ø¹ÙØ±Ø§Ù†"].baseYieldChange,
        crop_price_per_t: cropProfiles["Ø²Ø¹ÙØ±Ø§Ù†"].price_per_t,
        crop_quality_premium_or_discount_pct: 0,
        ag_opex_baseline_per_ha: 600000000,
        ag_opex_change_under_AGV_pct: -5,
        water_use_baseline_m3_per_ha: 6000,
        water_use_change_under_AGV_pct: cropProfiles["Ø²Ø¹ÙØ±Ø§Ù†"].waterSaving,
        pv_capacity_kWp_total: 150,
        module_price_per_kWp: 220000000,
        mounting_structure_cost_per_kWp: 70000000,
        inverter_BOS_cost_per_kWp: 60000000,
        grid_interconnection_lump_sum: 5000000000,
        EPC_soft_cost_pct_of_capex: 8,
        annual_pv_degradation_pct: 0.6,
        specific_yield_kWh_per_kWp_year: regions["torbat"].sun,
        soiling_loss_pct: dustLevels["med"].soiling,
        availability_pct: 98,
        pv_om_cost_per_kWp_year: 2500000,
        grid_scheme: "PPA/FIT",
        ppa_or_fit_tariff: 2500,
        net_metering_buy_price: 3000,
        net_metering_sell_price: 2200,
        self_consumption_share_pct: 40,
        curtailment_pct: 0,
        tariff_escalation_pct_per_year: 5,
        subsidy_capex_pct: 0,
        carbon_credit_price_per_tCO2: 0,
        avoided_co2_t_per_MWh: 0.55,
        insurance_cost_pct_of_asset_value_per_year: 1.2,
        land_lease_cost_per_ha_year: 0,
          tax_rate_pct: 0,
        });

        useEffect(() => {
          loadScenarioIfAny(setS);
        }, []);

        const set = (k, v) => setS(prev => ({ ...prev, [k]: v }));
      const pct = (x) => (Number(x) || 0) / 100;
      const nz = (x) => Number(x) || 0;
      const clamp = (v, min, max) => Math.max(min, Math.min(max, v));
      const fmt = (n) => new Intl.NumberFormat("fa-IR").format(Math.round(n || 0));
      const fmtMoney = (n) => `${fmt(n)} ${s.currency}`;

      useEffect(() => {
        const reg = regions[s.region];
        const crop = cropProfiles[s.crop_type] || cropProfiles["Ø²Ø¹ÙØ±Ø§Ù†"];
        const dust = dustLevels[s.dust_level];
        const src = waterSources[s.water_source];
        const soil = soils[s.soil_type];

        const newSpecificYield = reg.sun;
        const newSoiling = dust.soiling;
        const newIrrTariff = src.elec_tariff;
        const newWaterCost = src.water_cost;
        const newPumpKWhm3 = soil.pump_kWh_m3;

        const heat = reg.heat; // low/med/high
        let yieldChange = crop.baseYieldChange;
        let waterSaving = crop.waterSaving;
        if (heat === "high") { yieldChange += 1; waterSaving -= 3; }
        if (heat === "low")  { yieldChange -= 1; waterSaving += 2; }
        if (s.salinity_EC >= 4 && s.salinity_EC < 8) { yieldChange += 1; waterSaving -= 2; }
        if (s.salinity_EC >= 8) { yieldChange += 2; waterSaving -= 3; }

        setS(prev => ({
          ...prev,
          specific_yield_kWh_per_kWp_year: newSpecificYield,
          soiling_loss_pct: newSoiling,
          irrigation_energy_tariff: newIrrTariff ?? prev.irrigation_energy_tariff,
          water_unit_cost: newWaterCost ?? prev.water_unit_cost,
          energy_for_irrigation_kWh_per_m3: newPumpKWhm3 ?? prev.energy_for_irrigation_kWh_per_m3,
          expected_yield_change_pct_under_AGV: yieldChange,
          water_use_change_under_AGV_pct: waterSaving,
          baseline_yield_t_per_ha: crop.yield_t_ha,
          crop_price_per_t: crop.price_per_t,
        }));
      }, [s.region, s.crop_type, s.dust_level, s.water_source, s.soil_type, s.salinity_EC]);

      const area = nz(s.project_area_ha);
      const years = Math.max(1, Math.floor(nz(s.time_horizon_years)));

      const capex_per_kWp_sub = nz(s.module_price_per_kWp) + nz(s.mounting_structure_cost_per_kWp) + nz(s.inverter_BOS_cost_per_kWp);
      const capex_kWp_with_soft = capex_per_kWp_sub * (1 + pct(s.EPC_soft_cost_pct_of_capex));
      const subsidy = capex_kWp_with_soft * pct(s.subsidy_capex_pct);
      const capex_total = Math.max(0, nz(s.pv_capacity_kWp_total) * (capex_kWp_with_soft - subsidy) + nz(s.grid_interconnection_lump_sum));

      const pv_om_annual = nz(s.pv_capacity_kWp_total) * nz(s.pv_om_cost_per_kWp_year);
      const insurance_annual = capex_total * pct(s.insurance_cost_pct_of_asset_value_per_year);
      const land_lease_annual = area * nz(s.land_lease_cost_per_ha_year);

      const ag_yield_baseline = nz(s.baseline_yield_t_per_ha) * area;
      const ag_rev_baseline = ag_yield_baseline * nz(s.crop_price_per_t);
      const ag_opex_baseline_total = area * nz(s.ag_opex_baseline_per_ha);
      const water_m3_base = area * nz(s.water_use_baseline_m3_per_ha);
      const water_cost_base = water_m3_base * nz(s.water_unit_cost);
      const irrigation_energy_base_kWh = water_m3_base * nz(s.energy_for_irrigation_kWh_per_m3);
      const irrigation_energy_cost_base = irrigation_energy_base_kWh * nz(s.irrigation_energy_tariff || 0);

      const yield_change = 1 + pct(s.expected_yield_change_pct_under_AGV) + pct(s.crop_quality_premium_or_discount_pct);
      const ag_yield_agv = nz(s.baseline_yield_t_per_ha) * area * yield_change;
      const ag_rev_agv = ag_yield_agv * nz(s.crop_price_per_t);
      const ag_opex_agv_total = area * nz(s.ag_opex_baseline_per_ha) * (1 + pct(s.ag_opex_change_under_AGV_pct));
      const water_m3_agv = water_m3_base * (1 + pct(s.water_use_change_under_AGV_pct));
      const water_cost_agv = water_m3_agv * nz(s.water_unit_cost);
      const irrigation_energy_agv_kWh = water_m3_agv * nz(s.energy_for_irrigation_kWh_per_m3);
      const irrigation_energy_cost_agv = irrigation_energy_agv_kWh * nz(s.irrigation_energy_tariff || 0);

      const net_yield_factor = (1 - pct(s.soiling_loss_pct)) * (pct(s.availability_pct));
      const curtail = (1 - pct(s.curtailment_pct));
      const kWp = nz(s.pv_capacity_kWp_total);
      const annualPV = (y) => kWp * nz(s.specific_yield_kWh_per_kWp_year) * net_yield_factor * curtail * Math.pow(1 - pct(s.annual_pv_degradation_pct), y);
      const tariffEscal = (y) => Math.pow(1 + pct(s.tariff_escalation_pct_per_year), y);

      const elecRevenueYear = (y) => {
        const kWh = annualPV(y);
        const scheme = s.grid_scheme;
        if (scheme === "PPA/FIT") return kWh * nz(s.ppa_or_fit_tariff) * tariffEscal(y);
        if (scheme === "SelfConsumption") {
          const selfShare = Math.max(0, Math.min(1, pct(s.self_consumption_share_pct)));
          const self_kWh = kWh * selfShare;
          return self_kWh * nz(s.net_metering_buy_price) * tariffEscal(y);
        }
        const selfShare = Math.max(0, Math.min(1, pct(s.self_consumption_share_pct)));
        const self_kWh = kWh * selfShare;
        const export_kWh = kWh * (1 - selfShare);
        const avoided = self_kWh * nz(s.net_metering_buy_price) * tariffEscal(y);
        const sold = export_kWh * nz(s.net_metering_sell_price) * tariffEscal(y);
        return avoided + sold;
      };

      const carbonRevenueYear = (y) => (annualPV(y) / 1000) * nz(s.avoided_co2_t_per_MWh) * nz(s.carbon_credit_price_per_tCO2);

      const baselineAnnualNet = () => (
        ag_rev_baseline - ag_opex_baseline_total - water_cost_base - irrigation_energy_cost_base - land_lease_annual
      );
      const agvAnnualNetBeforePV = () => (
        ag_rev_agv - ag_opex_agv_total - water_cost_agv - irrigation_energy_cost_agv - land_lease_annual
      );
      const agvAnnualNet = (y) => (
        agvAnnualNetBeforePV() + elecRevenueYear(y) + carbonRevenueYear(y) - pv_om_annual - insurance_annual
      );

      const cashflowsBaseline = Array.from({ length: years }, () => baselineAnnualNet());
      const cashflowsAGV = Array.from({ length: years }, (_, y) => agvAnnualNet(y));
      const cashflowsAGV_WithCapex = [ -capex_total, ...cashflowsAGV ];
      const cashflowsBaseline_ZeroCapex = [ 0, ...cashflowsBaseline ];
      const cashflowsIncremental = cashflowsAGV_WithCapex.map((v, i) => v - (cashflowsBaseline_ZeroCapex[i] ?? 0));

      const npv = (ratePct, arr) => arr.reduce((acc, cf, i) => acc + cf / Math.pow(1 + (ratePct/100), i), 0);
      const irr = (arr) => { let lo=-0.9, hi=1.0; const f=r=>arr.reduce((a,c,i)=>a+c/Math.pow(1+r,i),0); let flo=f(lo), fhi=f(hi); if(isNaN(flo)||isNaN(fhi)||flo*fhi>0) return null; for(let k=0;k<80;k++){ const mid=(lo+hi)/2, fm=f(mid); if(Math.abs(fm)<1e-3) return mid; if(flo*fm<0){hi=mid; fhi=fm;} else {lo=mid; flo=fm;} } return (lo+hi)/2; };

      const NPV_incremental = npv(s.discount_rate_pct, cashflowsIncremental);
      const IRR_incremental = irr(cashflowsIncremental);

      const decisionText = () => {
        if (NPV_incremental > 0 && (IRR_incremental ?? 0) > (s.discount_rate_pct/100)) return "Ø¨Ù‡â€ŒØµØ±ÙÙ‡";
        if (Math.abs(NPV_incremental) < 0.05 * capex_total) return "ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ Ø³Ø± Ø¨Ù‡ Ø³Ø±";
        return "Ø¨Ù‡â€ŒØµØ±ÙÙ‡ Ù†ÛŒØ³Øª";
      };

      const totalPVkWhYear1 = annualPV(0);

      const Chart = ({ data, title, height=160 }) => {
        const w = 720, h = height, pad = 24;
        const n = data.length;
        const min = Math.min(...data, 0), max = Math.max(...data, 0);
        const scaleX = (i) => pad + (i * (w - 2*pad)) / Math.max(1, n - 1);
        const scaleY = (v) => { if (max === min) return h/2; return h - pad - ((v - min) * (h - 2*pad)) / (max - min); };
        const path = data.map((v,i)=> `${i===0?'M':'L'}${scaleX(i)},${scaleY(v)}`).join(' ');
        const zeroY = scaleY(0);
        return (
          <div className="rounded-2xl bg-neutral-950/60 border border-neutral-800 p-4">
            <div className="text-gray-300 text-sm mb-2">{title}</div>
            <svg width={w} height={h} className="max-w-full">
              <line x1={pad} y1={zeroY} x2={w-pad} y2={zeroY} stroke="#444" strokeDasharray="4 4" />
              <path d={path} fill="none" stroke="#10b981" strokeWidth="2" />
            </svg>
          </div>
        );
      };

      const downloadCSV = () => {
        const rows = [["Ø³Ø§Ù„","Ø¨Ø±Ù‚ (kWh)","Ø¯Ø±Ø¢Ù…Ø¯/ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø¨Ø±Ù‚","Ø®Ø§Ù„Øµ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ù‚Ø¨Ù„)","Ø®Ø§Ù„Øµ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ø¨Ø§)","Ø§ÙØ²Ø§ÛŒØ´ÛŒ"]];
        for (let i=0;i<years;i++) rows.push([ i+1, Math.round(annualPV(i)), Math.round(elecRevenueYear(i)), Math.round(cashflowsBaseline[i]), Math.round(cashflowsAGV[i]), Math.round(cashflowsIncremental[i+1] ?? 0) ]);
        const csv = rows.map(r=>r.join(",")).join("\n");
        const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
        const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'agrivoltaics_khorasan.csv'; a.click(); URL.revokeObjectURL(url);
      };

      return (
        <div dir="rtl" className="min-h-screen w-full bg-gradient-to-b from-neutral-950 to-neutral-900 text-gray-100 px-4 py-6 md:py-10 md:px-8">
          <header className="max-w-7xl mx-auto mb-6 md:mb-8 flex flex-col md:flex-row items-start md:items-center justify-between gap-4">
            <div>
              <h1 className="text-2xl md:text-3xl font-extrabold tracking-tight">Ù…Ø§Ø´ÛŒÙ†â€ŒØ­Ø³Ø§Ø¨ ÙÙˆØªÙˆÚ©ÙØ´Øª â€“ ÙˆÛŒÚ˜Ù‡ Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ</h1>
              <p className="text-sm md:text-base text-gray-300 mt-2">Ø¨Ø§ Ú†Ù†Ø¯ ÙˆØ±ÙˆØ¯ÛŒ Ø³Ø§Ø¯Ù‡ Ø¨Ø¨ÛŒÙ†ÛŒØ¯ Ú©ÙØ´Øª Ø²ÛŒØ± Ù¾Ù†Ù„ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ Ø¯Ø± Ù…Ù†Ø·Ù‚Ù‡ Ø´Ù…Ø§ Ù…ÛŒâ€ŒØµØ±ÙØ¯ ÛŒØ§ Ù†Ù‡.</p>
              <div className="mt-2 text-xs text-gray-400 space-y-1">
                <div>Û±) Ù…Ù†Ø·Ù‚Ù‡ØŒ Ù…Ø­ØµÙˆÙ„ØŒ Ø¢Ø¨ Ùˆ Ø®Ø§Ú© Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯. Ø§Ø¹Ø¯Ø§Ø¯ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø´Ø±Ø§ÛŒØ· Ø±Ø§ÛŒØ¬ Ø§Ø³ØªØ§Ù† Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</div>
                <div>Û²) Ø§Ú¯Ø± Ù„Ø§Ø²Ù… Ø¨ÙˆØ¯ØŒ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ Ùˆ Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ Ø¨Ø§ ÙˆØ¶Ø¹ÛŒØª Ø®ÙˆØ¯ØªØ§Ù† Ø¹ÙˆØ¶ Ú©Ù†ÛŒØ¯.</div>
                <div>Û³) Ù†ØªÛŒØ¬Ù‡ Ø±Ø§ Ø¯Ø± Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ Ùˆ Ù†Ù…ÙˆØ¯Ø§Ø± Ø¨Ø¨ÛŒÙ†ÛŒØ¯. Ø§Ú¯Ø± Â«Ø§Ø±Ø²Ø´ Ø§Ù…Ø±ÙˆØ²Â» Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯ØŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø·Ø±Ø­ Ø®ÙˆØ¨ Ø§Ø³Øª.</div>
              </div>
            </div>
            <div className="flex items-center gap-2 flex-wrap">
              <button className="px-3 py-2 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white" onClick={()=>setSimple(v=>!v)}>Ø­Ø§Ù„Øª {simple? 'Ù¾ÛŒØ´Ø±ÙØªÙ‡' : 'Ø³Ø§Ø¯Ù‡'}</button>
              <button onClick={downloadCSV} className="px-4 py-2 rounded-xl bg-neutral-800 border border-neutral-700 hover:bg-neutral-700 text-gray-100">Ø¯Ø§Ù†Ù„ÙˆØ¯ CSV</button>
              <button onClick={()=>saveScenario(s)} className="px-4 py-2 rounded-xl bg-neutral-800 border border-neutral-700 hover:bg-neutral-700 text-gray-100">Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ</button>
              <button onClick={()=>{const link=prompt("Ù„ÛŒÙ†Ú© Ø³Ù†Ø§Ø±ÛŒÙˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:"); if(link) location.href=link;}} className="px-4 py-2 rounded-xl bg-neutral-800 border border-neutral-700 hover:bg-neutral-700 text-gray-100">Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ø§Ø² Ù„ÛŒÙ†Ú©</button>
            </div>
          </header>

          <main className="max-w-7xl mx-auto space-y-6 md:space-y-8">
            <section className="bg-neutral-950/60 border border-neutral-800 rounded-2xl p-4 md:p-6 shadow-xl">
              <h2 className="text-emerald-400 text-base md:text-lg font-bold mb-3">Û°) Ù…Ù†Ø·Ù‚Ù‡ Ùˆ Ø´Ø±Ø§ÛŒØ· Ù…Ø­Ù„ÛŒ</h2>
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
                <Select label="Ù…Ù†Ø·Ù‚Ù‡" value={s.region} onChange={(v)=>set("region", v)} options={Object.entries(regions).map(([k,v])=>({value:k,label:v.title}))} />
                <Select label="Ù…Ø­ØµÙˆÙ„" value={s.crop_type} onChange={(v)=>set("crop_type", v)} options={Object.keys(cropProfiles).map(k=>({value:k,label:k}))} />
                <Select label="Ù…Ù†Ø¨Ø¹ Ø¢Ø¨" value={s.water_source} onChange={(v)=>set("water_source", v)} options={Object.entries(waterSources).map(([k,v])=>({value:k,label:v.title}))} />
                <Select label="Ú¯Ø±Ø¯ Ùˆ ØºØ¨Ø§Ø±" value={s.dust_level} onChange={(v)=>set("dust_level", v)} options={Object.entries(dustLevels).map(([k,v])=>({value:k,label:v.title}))} />
                <Select label="Ù†ÙˆØ¹ Ø®Ø§Ú©" value={s.soil_type} onChange={(v)=>set("soil_type", v)} options={Object.entries(soils).map(([k,v])=>({value:k,label:v.title}))} />
                <NumberInput label="Ø´ÙˆØ±ÛŒ Ø¢Ø¨/Ø®Ø§Ú© (EC dS/m)" value={s.salinity_EC} onChange={(v)=>set("salinity_EC", v)} step={0.5} />
              </div>
              <p className="text-xs text-gray-400 mt-3">* Ø§Ú¯Ø± Ù…Ù†Ø·Ù‚Ù‡ Ø¯Ù‚ÛŒÙ‚ Ø´Ù…Ø§ Ø¯Ø± Ù„ÛŒØ³Øª Ù†ÛŒØ³ØªØŒ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù…Ù†Ø·Ù‚Ù‡ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ Ùˆ Ø§Ø¹Ø¯Ø§Ø¯ Ø±Ø§ Ú©Ù…ÛŒ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.</p>
            </section>

            <div className="grid md:grid-cols-2 lg:grid-cols-5 gap-3 md:gap-4">
              <KPI title="Ù‡Ø²ÛŒÙ†Ù‡ Ø§ÙˆÙ„ÛŒÙ‡ Ø³Ø§Ø®Øª" value={fmtMoney(capex_total)} sub="Ù¾Ù†Ù„ØŒ Ø³Ø§Ø²Ù‡ØŒ Ø§ÛŒÙ†ÙˆØ±ØªØ±ØŒ Ø§ØªØµØ§Ù„" />
              <KPI title="Ø¨Ø±Ù‚ Ø³Ø§Ù„ Ø§ÙˆÙ„" value={`${fmt(totalPVkWhYear1)} kWh`} sub="Ù¾Ø³ Ø§Ø² Ú©Ø«ÛŒÙÛŒ/Ø®Ø±Ø§Ø¨ÛŒ" />
              <KPI title="Ø¯Ø±Ø¢Ù…Ø¯/ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø¨Ø±Ù‚ Ø³Ø§Ù„ Ø§ÙˆÙ„" value={fmtMoney(elecRevenueYear(0))} sub="Ø·Ø¨Ù‚ Ø·Ø±Ø­ Ø§Ù†ØªØ®Ø§Ø¨ÛŒ" />
              <KPI title="Ø§Ø±Ø²Ø´ Ø§Ù…Ø±ÙˆØ² Ø³ÙˆØ¯" value={fmtMoney(npv(s.discount_rate_pct, cashflowsIncremental))} sub={`Ø¨Ø§ Ù†Ø±Ø® ${s.discount_rate_pct}%`} />
              <KPI title="Ø³ÙˆØ¯ Ø³Ø§Ù„Ø§Ù†Ù‡ ØªÙ‚Ø±ÛŒØ¨ÛŒ" value={IRR_incremental==null? 'Ù†Ø§Ù…Ø´Ø®Øµ' : `${(IRR_incremental*100).toFixed(1)} %`} sub="Ù‡Ø±Ú†Ù‡ Ø¨ÛŒØ´ØªØ±ØŒ Ø¨Ù‡ØªØ±" />
            </div>

            <div className={`rounded-2xl p-4 border shadow-xl ${decisionText()==='Ø¨Ù‡â€ŒØµØ±ÙÙ‡' ? 'bg-emerald-900/30 border-emerald-700' : decisionText()==='ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ Ø³Ø± Ø¨Ù‡ Ø³Ø±' ? 'bg-yellow-900/30 border-yellow-700' : 'bg-rose-900/30 border-rose-700'}`}>
              <div className="text-sm">Ø®Ù„Ø§ØµÙ‡ ØªØµÙ…ÛŒÙ…:</div>
              <div className="text-lg font-bold mt-1">{decisionText()}</div>
              <div className="text-xs text-gray-300 mt-1">Ø§Ú¯Ø± Â«Ø§Ø±Ø²Ø´ Ø§Ù…Ø±ÙˆØ²Â» Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯ Ùˆ Ø¨Ø§Ø²Ú¯Ø´Øª Ø³Ø±Ù…Ø§ÛŒÙ‡ Ø¯Ø± Ú†Ù†Ø¯ Ø³Ø§Ù„ Ø§ÙˆÙ„ Ø±Ø® Ø¯Ù‡Ø¯ØŒ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø·Ø±Ø­ Ø§Ù‚ØªØµØ§Ø¯ÛŒ Ø§Ø³Øª.</div>
            </div>

            <Section title="Û±) Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø²Ù…ÛŒÙ† Ùˆ Ù…Ø­ØµÙˆÙ„">
              <NumberInput label="Ù…Ø³Ø§Ø­Øª Ø²Ù…ÛŒÙ† (Ù‡Ú©ØªØ§Ø±)" value={s.project_area_ha} onChange={(v)=>set("project_area_ha", v)} step={0.1} />
              <NumberInput label="Ø¹Ù…Ù„Ú©Ø±Ø¯ ÙØ¹Ù„ÛŒ (ØªÙ†/Ù‡Ú©ØªØ§Ø±)" value={s.baseline_yield_t_per_ha} onChange={(v)=>set("baseline_yield_t_per_ha", v)} step={0.1} />
              <NumberInput label="ØªØºÛŒÛŒØ± Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø²ÛŒØ± Ù¾Ù†Ù„ (%)" value={s.expected_yield_change_pct_under_AGV} onChange={(v)=>set("expected_yield_change_pct_under_AGV", v)} step={0.5} />
              <NumberInput label="Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ Ù…Ø­ØµÙˆÙ„ (Ø±ÛŒØ§Ù„/ØªÙ†)" value={s.crop_price_per_t} onChange={(v)=>set("crop_price_per_t", v)} step={1000000} />
              <NumberInput label="Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø§Ù„Ø§Ù†Ù‡ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ø±ÛŒØ§Ù„/Ù‡Ú©ØªØ§Ø±)" value={s.ag_opex_baseline_per_ha} onChange={(v)=>set("ag_opex_baseline_per_ha", v)} step={1000000} />
              <NumberInput label="ØªØºÛŒÛŒØ± Ù‡Ø²ÛŒÙ†Ù‡ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (%)" value={s.ag_opex_change_under_AGV_pct} onChange={(v)=>set("ag_opex_change_under_AGV_pct", v)} step={0.5} />
              <NumberInput label="Ù…ØµØ±Ù Ø¢Ø¨ ÙØ¹Ù„ÛŒ (mÂ³/Ù‡Ú©ØªØ§Ø±)" value={s.water_use_baseline_m3_per_ha} onChange={(v)=>set("water_use_baseline_m3_per_ha", v)} step={10} />
              <NumberInput label="ØªØºÛŒÛŒØ± Ù…ØµØ±Ù Ø¢Ø¨ (%)" value={s.water_use_change_under_AGV_pct} onChange={(v)=>set("water_use_change_under_AGV_pct", v)} step={1} />
              <NumberInput label="Ø´ÛŒØ±ÛŒÙ†ÛŒ/ØªÙ„Ø®ÛŒ Ù‚ÛŒÙ…Øª (Ú©ÛŒÙÛŒØª) (%)" value={s.crop_quality_premium_or_discount_pct} onChange={(v)=>set("crop_quality_premium_or_discount_pct", v)} step={0.5} />
            </Section>

            <Section title="Û²) Ø¢Ø¨ÛŒØ§Ø±ÛŒ Ùˆ Ø¨Ø±Ù‚ Ù…Ø²Ø±Ø¹Ù‡">
              <NumberInput label="Ø¨Ø±Ù‚ Ù¾Ù…Ù¾Ø§Ú˜ Ø¢Ø¨ (kWh Ø¨Ø±Ø§ÛŒ Ù‡Ø± mÂ³)" value={s.energy_for_irrigation_kWh_per_m3} onChange={(v)=>set("energy_for_irrigation_kWh_per_m3", v)} step={0.01} />
              <NumberInput label="Ù‚ÛŒÙ…Øª Ø¨Ø±Ù‚ Ø¨Ø±Ø§ÛŒ Ù¾Ù…Ù¾Ø§Ú˜ (Ø±ÛŒØ§Ù„/kWh)" value={s.irrigation_energy_tariff || 0} onChange={(v)=>set("irrigation_energy_tariff", v)} step={50} />
              <NumberInput label="Ù‚ÛŒÙ…Øª Ø¢Ø¨ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒâ€ŒØ´Ø¯Ù‡ (Ø±ÛŒØ§Ù„/mÂ³)" value={s.water_unit_cost} onChange={(v)=>set("water_unit_cost", v)} step={100} />
              <Select label="Ø·Ø±Ø­ Ù…ØµØ±Ù/ÙØ±ÙˆØ´ Ø¨Ø±Ù‚" value={s.grid_scheme} onChange={(v)=>set("grid_scheme", v)} options={[{value:"PPA/FIT",label:"ÙØ±ÙˆØ´ ØªØ¶Ù…ÛŒÙ†ÛŒ"},{value:"NetMetering",label:"ØªØ±Ø§Ø² Ø¨Ø§ Ø´Ø¨Ú©Ù‡"},{value:"SelfConsumption",label:"Ù…ØµØ±Ù Ø¯Ø± Ù…Ø²Ø±Ø¹Ù‡"}]} />
              <NumberInput label="Ù‚ÛŒÙ…Øª ØªØ¶Ù…ÛŒÙ†ÛŒ/ÙØ±ÙˆØ´ (Ø±ÛŒØ§Ù„/kWh)" value={s.ppa_or_fit_tariff} onChange={(v)=>set("ppa_or_fit_tariff", v)} step={50} />
              <NumberInput label="Ø³Ù‡Ù… Ù…ØµØ±Ù Ø¯Ø± Ù…Ø²Ø±Ø¹Ù‡ (%)" value={s.self_consumption_share_pct} onChange={(v)=>set("self_consumption_share_pct", v)} step={1} />
              <NumberInput label="Ù‚ÛŒÙ…Øª Ø®Ø±ÛŒØ¯ Ø§Ø² Ø´Ø¨Ú©Ù‡ (Ø±ÛŒØ§Ù„/kWh)" value={s.net_metering_buy_price} onChange={(v)=>set("net_metering_buy_price", v)} step={50} />
              <NumberInput label="Ù‚ÛŒÙ…Øª ÙØ±ÙˆØ´ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ (Ø±ÛŒØ§Ù„/kWh)" value={s.net_metering_sell_price} onChange={(v)=>set("net_metering_sell_price", v)} step={50} />
            </Section>

            <Section title="Û³) Ø¨Ø±Ù‚ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ (Ø§Ù†Ø¯Ø§Ø²Ù‡ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø§Ø®Øª)">
              <NumberInput label="Ø¸Ø±ÙÛŒØª Ú©Ù„ Ø³Ø§Ù…Ø§Ù†Ù‡ (kWp)" value={s.pv_capacity_kWp_total} onChange={(v)=>set("pv_capacity_kWp_total", v)} />
              <NumberInput label="ØªÙˆÙ„ÛŒØ¯ ÙˆÛŒÚ˜Ù‡ Ø³Ø§Ù„Ø§Ù†Ù‡ (kWh/kWp)" value={s.specific_yield_kWh_per_kWp_year} onChange={(v)=>set("specific_yield_kWh_per_kWp_year", v)} step={10} />
              <NumberInput label="Ù‚ÛŒÙ…Øª Ù¾Ù†Ù„ (Ø±ÛŒØ§Ù„/kWp)" value={s.module_price_per_kWp} onChange={(v)=>set("module_price_per_kWp", v)} step={1000000} />
              <NumberInput label="Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø§Ø²Ù‡ (Ø±ÛŒØ§Ù„/kWp)" value={s.mounting_structure_cost_per_kWp} onChange={(v)=>set("mounting_structure_cost_per_kWp", v)} step={1000000} />
              <NumberInput label="Ø§ÛŒÙ†ÙˆØ±ØªØ± Ùˆ Ú©Ø§Ø¨Ù„â€ŒÚ©Ø´ÛŒ (Ø±ÛŒØ§Ù„/kWp)" value={s.inverter_BOS_cost_per_kWp} onChange={(v)=>set("inverter_BOS_cost_per_kWp", v)} step={1000000} />
              <NumberInput label="Ù‡Ø²ÛŒÙ†Ù‡ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡ (ÛŒÚ©Ø¬Ø§)" value={s.grid_interconnection_lump_sum} onChange={(v)=>set("grid_interconnection_lump_sum", v)} step={1000000} />
              {!simple && <>
                <NumberInput label="Ø®Ø¯Ù…Ø§Øª/Ù…Ø¬ÙˆØ²/Ø·Ø±Ø§Ø­ÛŒ (%)" value={s.EPC_soft_cost_pct_of_capex} onChange={(v)=>set("EPC_soft_cost_pct_of_capex", v)} step={0.5} />
                <NumberInput label="Ú©Ø§Ù‡Ø´ Ø±Ø§Ù†Ø¯Ù…Ø§Ù† Ù¾Ù†Ù„ (% Ø³Ø§Ù„Ø§Ù†Ù‡)" value={s.annual_pv_degradation_pct} onChange={(v)=>set("annual_pv_degradation_pct", v)} step={0.1} />
                <NumberInput label="Ú©Ø«ÛŒÙÛŒ Ù¾Ù†Ù„ (Ùª)" value={s.soiling_loss_pct} onChange={(v)=>set("soiling_loss_pct", v)} step={0.5} />
                <NumberInput label="Ø¯Ø³ØªØ±Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ Ø³Ø§Ù…Ø§Ù†Ù‡ (Ùª)" value={s.availability_pct} onChange={(v)=>set("availability_pct", v)} step={0.5} />
                <NumberInput label="Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡ (Ø±ÛŒØ§Ù„/kWp)" value={s.pv_om_cost_per_kWp_year} onChange={(v)=>set("pv_om_cost_per_kWp_year", v)} step={10000} />
              </>}
            </Section>

            <section className="bg-neutral-950/60 border border-neutral-800 rounded-2xl p-4 md:p-6 shadow-xl">
              <h2 className="text-emerald-400 text-base md:text-lg font-bold mb-3">Ù†ØªØ§ÛŒØ¬ Ø®Ù„Ø§ØµÙ‡</h2>
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
                <KV k="Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ù‚Ø¨Ù„ Ø§Ø² Ù¾Ù†Ù„)" v={fmtMoney(ag_rev_baseline)} />
                <KV k="Ø¯Ø±Ø¢Ù…Ø¯ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ø¨Ø§ Ù¾Ù†Ù„)" v={fmtMoney(ag_rev_agv)} />
                <KV k="Ù‡Ø²ÛŒÙ†Ù‡ Ø¢Ø¨ (Ù‚Ø¨Ù„)" v={fmtMoney(water_cost_base)} />
                <KV k="Ù‡Ø²ÛŒÙ†Ù‡ Ø¢Ø¨ (Ø¨Ø§ Ù¾Ù†Ù„)" v={fmtMoney(water_cost_agv)} />
                <KV k="Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ù…Ù¾Ø§Ú˜ (Ù‚Ø¨Ù„)" v={fmtMoney(irrigation_energy_cost_base)} />
                <KV k="Ù‡Ø²ÛŒÙ†Ù‡ Ø§Ù†Ø±Ú˜ÛŒ Ù¾Ù…Ù¾Ø§Ú˜ (Ø¨Ø§ Ù¾Ù†Ù„)" v={fmtMoney(irrigation_energy_cost_agv)} />
                <KV k="Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø³Ø§Ù„Ø§Ù†Ù‡ Ø³Ø§Ù…Ø§Ù†Ù‡ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ" v={fmtMoney(pv_om_annual)} />
                <KV k="Ø¨ÛŒÙ…Ù‡ Ø³Ø§Ù„Ø§Ù†Ù‡" v={fmtMoney(insurance_annual)} />
              </div>
            </section>

            <div className="grid lg:grid-cols-2 gap-4">
              <Chart title="Ø¬Ø±ÛŒØ§Ù† Ù†Ù‚Ø¯ÛŒ Ø§ÙØ²Ø§ÛŒØ´ÛŒ Ù‡Ø± Ø³Ø§Ù„" data={cashflowsIncremental.slice(1)} />
              {(()=>{const cum=[];let c=0;for(let i=0;i<cashflowsIncremental.length;i++){c+=cashflowsIncremental[i];cum.push(c);}return <Chart title="Ø¬Ù…Ø¹Ù Ø¬Ø±ÛŒØ§Ù† Ù†Ù‚Ø¯ÛŒ Ø§Ø² Ø´Ø±ÙˆØ¹ Ù¾Ø±ÙˆÚ˜Ù‡" data={cum} />;})()}
            </div>

            <section className="bg-neutral-950/60 border border-neutral-800 rounded-2xl p-4 md:p-6 shadow-xl overflow-x-auto">
              <h2 className="text-emerald-400 text-base md:text-lg font-bold mb-4">Ø¬Ø¯ÙˆÙ„ Ø³Ø§Ù„â€ŒØ¨Ù‡â€ŒØ³Ø§Ù„</h2>
              <table className="w-full text-sm">
                <thead className="text-gray-300">
                  <tr className="border-b border-neutral-800">
                    <th className="py-2 text-right">Ø³Ø§Ù„</th>
                    <th className="py-2 text-right">Ø¨Ø±Ù‚ (kWh)</th>
                    <th className="py-2 text-right">Ø¯Ø±Ø¢Ù…Ø¯/ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø¨Ø±Ù‚</th>
                    <th className="py-2 text-right">Ø®Ø§Ù„Øµ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ù‚Ø¨Ù„)</th>
                    <th className="py-2 text-right">Ø®Ø§Ù„Øµ Ú©Ø´Ø§ÙˆØ±Ø²ÛŒ (Ø¨Ø§ Ù¾Ù†Ù„)</th>
                    <th className="py-2 text-right">Ø§ÙØ²Ø§ÛŒØ´ÛŒ</th>
                  </tr>
                </thead>
                <tbody>
                  {cashflowsAGV.map((_, i) => (
                    <tr key={i} className="border-b border-neutral-900 hover:bg-neutral-900/40">
                      <td className="py-2">{i+1}</td>
                      <td className="py-2">{fmt(annualPV(i))}</td>
                      <td className="py-2">{fmtMoney(elecRevenueYear(i) + carbonRevenueYear(i))}</td>
                      <td className="py-2">{fmtMoney(cashflowsBaseline[i])}</td>
                      <td className="py-2">{fmtMoney(cashflowsAGV[i])}</td>
                      <td className="py-2">{fmtMoney(cashflowsIncremental[i+1] ?? 0)}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
              <div className="mt-4 text-xs text-gray-400">* Ø³Ø§Ù„ ØµÙØ± Ø´Ø§Ù…Ù„ Ù‡Ø²ÛŒÙ†Ù‡ Ø³Ø§Ø®Øª Ø§Ø³Øª Ùˆ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ù†ÛŒØ§Ù…Ø¯Ù‡ Ø§Ø³Øª.</div>
            </section>

            <div className="text-xs text-gray-400 pb-8">
              Ù†Ú©ØªÙ‡: Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ø¨ÛŒØ´ØªØ±ØŒ Ù‚ÛŒÙ…Øª Ù…Ø­ØµÙˆÙ„ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡ Ø¢Ø¨/Ø¨Ø±Ù‚ Ø±Ø§ Ø§Ø² ÙÛŒØ´â€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± Ø®ÙˆØ¯ØªØ§Ù† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯. Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒØ¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒÙ… Ù†Ø³Ø®Ù‡ Ø±ÙˆØ³ØªØ§ÛŒÛŒ/Ø¯Ù‡Ø³ØªØ§Ù†ÛŒ Ø¨Ø§ Ø§Ø¹Ø¯Ø§Ø¯ Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±ÛŒ Ø¨Ø³Ø§Ø²ÛŒÙ….
            </div>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<AgrivoltaicsKhorasan/>);
  </script>
 
</body>
</html>
