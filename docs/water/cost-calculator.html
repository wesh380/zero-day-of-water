<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ماشین‌حساب پیشرفته قیمت تمام‌شده آب در مشهد</title>
  <link rel="stylesheet" href="../assets/tailwind.css">
  <link rel="stylesheet" href="../assets/fonts.css">
  <link rel="stylesheet" href="../assets/water-cost.css">
  <link rel="stylesheet" href="/assets/global-footer.css">
  <link rel="stylesheet" href="/assets/unified-badge.css">
  <link rel="stylesheet" href="../assets/inline-migration.css" />
  <script defer src="/assets/unified-badge.js"></script>
  <script defer src="/assets/global-footer.js"></script>
</head>
<body>
  <main class="container">
  <h1 class="page-title">ماشین‌حساب پیشرفته قیمت تمام‌شده آب در مشهد</h1>
  <div class="page-sub">شِمای تمیز و کادربندی‌شده؛ ورودی‌ها در راست، خروجی‌ها در چپ</div>

  <section class="grid">
    <!-- ستون چپ: خروجی‌های مدل -->
    <div class="left">
      <div class="stat-wrap">
        <div class="stat badge-warn">
          <div class="label">قیمت پیشنهادی واقعی (به ازای هر مترمکعب)</div>
          <div id="true-price" class="value">—</div>
          <span class="badge" id="true-price-unit">تومان</span>
        </div>
        <div class="stat badge-success">
          <div class="label">قیمت نهایی برای مصرف‌کننده (پس از یارانه/تخفیف)</div>
          <div id="final-price" class="value">—</div>
          <span class="badge" id="final-price-unit">تومان</span>
        </div>
      </div>

      <div class="card dash-card">
        <h3>جدول سهم هر متغیر</h3>
        <table class="tbl" aria-describedby="tbl-hint">
          <thead>
            <tr><th>آیتم</th><th>سهم</th><th>پیشرفت</th><th>هزینه</th></tr>
          </thead>
          <tbody id="breakdown-body"><!-- filled by JS --></tbody>
        </table>
        <div id="tbl-hint" class="hint" style="margin-top:8px">مقادیر با تغییر ورودی‌ها به‌روزرسانی می‌شوند.</div>
      </div>

      <div class="card dash-card">
        <h3>نمودار دونات سهم عوامل</h3>
        <div class="chart-box"><canvas id="shareChart"></canvas></div>
      </div>

      <div class="card dash-card">
        <h3>تحلیل حساسیت (±۱۰٪ در ورودی‌ها)</h3>
        <ul id="sensitivity-list" class="list"><!-- li items by JS --></ul>
      </div>

      <div class="card dash-card note">
        <h3>جمع‌بندی تحلیل</h3>
        <div id="analysis-summary">—</div>
      </div>
    </div>

    <!-- ستون راست: ورودی‌های مدل -->
    <div class="right controls">
      <div class="card dash-card">
        <h3>۱) عوامل فنی و زیربنایی</h3>
        <div class="group">
          <label for="cost_production">هزینه تولید هر مترمکعب (تومان)</label>
          <div class="inline">
            <input id="cost_production" type="number" min="0" step="100" value="2000" aria-describedby="cost_production_r">
          </div>
          <input id="cost_production_r" type="range" min="0" max="10000" step="100" value="2000">
        </div>
        <div class="group">
          <label for="cost_energy">هزینه انرژی (تومان)</label>
          <input id="cost_energy" type="number" min="0" step="50" value="2000">
          <input id="cost_energy_r" type="range" min="0" max="10000" step="50" value="2000">
        </div>
        <div class="group">
          <label for="loss_network">درصد هدررفت شبکه (%)</label>
          <input id="loss_network" type="number" min="0" max="100" step="1" value="20">
          <input id="loss_network_r" type="range" min="0" max="100" step="1" value="20">
        </div>
      </div>

      <div class="card dash-card">
        <h3>۲) عوامل اقتصادی و مدیریتی</h3>
        <div class="group">
          <label for="maintenance">هزینه نگهداری و تعمیرات (تومان)</label>
          <input id="maintenance" type="number" min="0" step="50" value="1500">
          <input id="maintenance_r" type="range" min="0" max="10000" step="50" value="1500">
        </div>
        <div class="group">
          <label for="hidden_subsidy">درصد یارانه پنهان (%)</label>
          <input id="hidden_subsidy" type="number" min="0" max="100" step="1" value="25">
          <input id="hidden_subsidy_r" type="range" min="0" max="100" step="1" value="25">
        </div>
      </div>

      <div class="card dash-card">
        <h3>۳) محیطی و اجتماعی</h3>
        <div class="group">
          <label for="power_change">درصد تغییر قیمتی برق (%)</label>
          <input id="power_change" type="number" min="-100" max="100" step="1" value="0">
          <input id="power_change_r" type="range" min="-100" max="100" step="1" value="0">
        </div>
      </div>

      <div class="card dash-card">
        <h3>آزمون ورودی‌ها</h3>
        <div class="group">
          <label for="chargeinput">شارژ</label>
          <input id="chargeinput" type="text" />
        </div>
        <div class="group">
          <label for="voteinput">رأی</label>
          <input id="voteinput" type="text" />
        </div>
      </div>

      <div class="actions">
        <button id="recalc" class="btn btn-primary" type="button">به‌روزرسانی محاسبات</button>
        <a class="btn" href="../index.html">بازگشت</a>
      </div>
    </div>
  </section>

  <!-- فوتر فعلی سایت شما بدون تغییر بماند -->
  <div class="footer-note">با هر تغییر در ورودی‌ها، نتایج به‌صورت زنده محاسبه می‌شوند.</div>
</main>

  <script src="/assets/vendor/chart.umd.min.js"></script>
  <script defer src="../assets/water-cost.js"></script>
  <script defer src="../assets/water-init.js"></script>
</body>
</html>
