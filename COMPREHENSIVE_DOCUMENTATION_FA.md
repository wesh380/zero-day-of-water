# ğŸ“˜ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¬Ø§Ù…Ø¹ Ù¾Ù„ØªÙØ±Ù… wesh360.ir

**Ù†Ø³Ø®Ù‡:** 1.0.0
**ØªØ§Ø±ÛŒØ®:** Û±Û´Û°Û³/Û±Û±/Û±Û¶
**Ù¾Ø±ÙˆÚ˜Ù‡:** zero-day-of-water2
**ÙˆØ¨Ø³Ø§ÛŒØª:** https://wesh360.ir

---

## ğŸ“‘ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ù…Ø¹Ø±ÙÛŒ Ú©Ù„ÛŒ](#Ù…Ø¹Ø±ÙÛŒ-Ú©Ù„ÛŒ)
2. [Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…](#Ù…Ø¹Ù…Ø§Ø±ÛŒ-Ø³ÛŒØ³ØªÙ…)
3. [Ù¾Ø´ØªÙ‡ ÙÙ†Ø§ÙˆØ±ÛŒ](#Ù¾Ø´ØªÙ‡-ÙÙ†Ø§ÙˆØ±ÛŒ)
4. [ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ](#ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ-Ú©Ù„ÛŒØ¯ÛŒ)
5. [Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡](#Ø³Ø§Ø®ØªØ§Ø±-Ù¾Ø±ÙˆÚ˜Ù‡)
6. [Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ](#Ù…Ø´Ú©Ù„Ø§Øª-Ùˆ-Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ-ÙØ¹Ù„ÛŒ)
7. [Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡](#Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ-Ø§Ù†Ø¬Ø§Ù…-Ø´Ø¯Ù‡)
8. [Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡](#Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ-ØªÙˆØ³Ø¹Ù‡)
9. [Ù…Ø³ØªÙ†Ø¯Ø§Øª API](#Ù…Ø³ØªÙ†Ø¯Ø§Øª-api)
10. [Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡](#Ù¾Ø§ÛŒÚ¯Ø§Ù‡-Ø¯Ø§Ø¯Ù‡)
11. [Ø§Ù…Ù†ÛŒØª Ùˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§](#Ø§Ù…Ù†ÛŒØª-Ùˆ-Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§)
12. [Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡](#Ù†Ù‚Ø´Ù‡-Ø±Ø§Ù‡-Ø¢ÛŒÙ†Ø¯Ù‡)

---

## ğŸ¯ Ù…Ø¹Ø±ÙÛŒ Ú©Ù„ÛŒ

### Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡

Ù¾Ù„ØªÙØ±Ù… **wesh360.ir** ÛŒÚ© Ø³ÛŒØ³ØªÙ… Ø¬Ø§Ù…Ø¹ ØªØ­Ù„ÛŒÙ„ Ùˆ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ø¢Ø¨ Ùˆ Ø§Ù†Ø±Ú˜ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªØ§Ù† Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ Ø§Ø³Øª Ú©Ù‡ Ø§Ù…Ú©Ø§Ù†Ø§Øª Ø²ÛŒØ± Ø±Ø§ ÙØ±Ø§Ù‡Ù… Ù…ÛŒâ€ŒÚ©Ù†Ø¯:

- ğŸ“Š **ØªØ­Ù„ÛŒÙ„ Ùˆ Ù…Ø¯Ù„â€ŒØ³Ø§Ø²ÛŒ Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ Ø¢Ø¨** Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Causal Loop Diagrams (CLD)
- ğŸ—ºï¸ **Ù†Ù‚Ø´Ù‡ ØªØ¹Ø§Ù…Ù„ÛŒ Ø¢Ù…Ø§ÛŒØ´ Ø§Ù†Ø±Ú˜ÛŒ** Ø¨Ø§ Ù†Ù…Ø§ÛŒØ´ Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒØŒ Ø¨Ø§Ø¯ÛŒ Ùˆ Ø³Ø¯Ù‡Ø§
- âš¡ **Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø± Ù‡Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø¨ Ùˆ Ø¨Ø±Ù‚** Ø¨Ø§ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ ÙˆØ§Ù‚Ø¹ÛŒ
- ğŸ¤– **ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§ AI** (Google Gemini)
- ğŸ“ˆ **Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ** Ø¨Ø±Ø§ÛŒ Ø¢Ø¨ØŒ Ø¨Ø±Ù‚ØŒ Ú¯Ø§Ø² Ùˆ Ù†ÙØª

### Ø§Ù‡Ø¯Ø§Ù Ú©Ù„ÛŒØ¯ÛŒ

1. **Ø³Ø§Ø¯Ú¯ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ**: Ø§Ø±Ø§Ø¦Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø¨Ù‡ ØµÙˆØ±Øª ØªØ¹Ø§Ù…Ù„ÛŒ Ùˆ Ù‚Ø§Ø¨Ù„ ÙÙ‡Ù…
2. **Ø¹Ù…Ù„Ú©Ø±Ø¯ Ø¨Ø§Ù„Ø§**: Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø±ÛŒØ¹ Ùˆ ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø±ÙˆØ§Ù† (Core Web Vitals)
3. **Ù…Ù‚ÛŒØ§Ø³â€ŒÙ¾Ø°ÛŒØ±ÛŒ**: Ù…Ø¹Ù…Ø§Ø±ÛŒ serverless Ø¨Ø§ Ù‡Ø²ÛŒÙ†Ù‡ ØµÙØ± ØªØ§ Ø­Ø¯ Ø§Ù…Ú©Ø§Ù†
4. **Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ¾Ø°ÛŒØ±ÛŒ**: Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ú©Ø§Ù…Ù„ Ø§Ø² RTLØŒ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§ÛŒ ARIA

---

## ğŸ—ï¸ Ù…Ø¹Ù…Ø§Ø±ÛŒ Ø³ÛŒØ³ØªÙ…

### Ø§Ù„Ú¯ÙˆÛŒ Ù…Ø¹Ù…Ø§Ø±ÛŒ

**Ù†ÙˆØ¹:** Hybrid JAMstack + Microservices (Serverless)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Frontend Layer                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ GitHub Pages â”‚  â”‚  Next.js App â”‚  â”‚ Static JS â”‚ â”‚
â”‚  â”‚ (Static Site)â”‚  â”‚  (Dashboard) â”‚  â”‚ Dashboardsâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“ HTTP/HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     API Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Netlify Functionsâ”‚        â”‚   FastAPI Server â”‚  â”‚
â”‚  â”‚   (Serverless)   â”‚        â”‚ (Local/Windows)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Data Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚Supabase PostgreSQL        â”‚   Google Gemini  â”‚  â”‚
â”‚  â”‚   (Free Tier)    â”‚        â”‚      API         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…

#### 1. Frontend Tier (Ù„Ø§ÛŒÙ‡ Ù†Ù…Ø§ÛŒØ´)

**GitHub Pages** (`/docs`)
- Ø®Ø¯Ù…Øªâ€ŒØ¯Ù‡ÛŒ Ø§Ø³ØªØ§ØªÛŒÚ© HTML/CSS/JS
- Ù‡Ø²ÛŒÙ†Ù‡ ØµÙØ±
- CDN Ø¬Ù‡Ø§Ù†ÛŒ ØªÙˆØ³Ø· GitHub
- Ù…Ø³ÛŒØ±: `https://wesh360.ir/`

**Next.js Application** (`/app`)
- ØµÙØ­Ù‡ ÙØ±ÙˆØ¯ Ø§ØµÙ„ÛŒ
- Server Components + Client Components
- Export Ø§Ø³ØªØ§ØªÛŒÚ© Ø¨Ù‡ `/docs`
- Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ SEO Ùˆ ØªØµØ§ÙˆÛŒØ±

**Vanilla JS Dashboards** (`/dash`)
- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ Ø³Ø¨Ú©â€ŒÙˆØ²Ù†
- Ø¨Ø¯ÙˆÙ† framework overhead
- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø±ÛŒØ¹

#### 2. API Tier (Ù„Ø§ÛŒÙ‡ Ù…Ù†Ø·Ù‚)

**Netlify Functions** (`/netlify/functions`)
- 8 ØªØ§Ø¨Ø¹ Serverless:
  - `save-scenario.js` - Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
  - `get-scenario.js` - Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§
  - `get-tariff.js` - Ø¯Ø±ÛŒØ§ÙØª ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù‚
  - `cld-submit.js` - Ø§Ø±Ø³Ø§Ù„ CLD Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´
  - `cld-result.js` - Ø¯Ø±ÛŒØ§ÙØª Ù†ØªØ§ÛŒØ¬
  - `cld-worker.js` - Ù¾Ø±Ø¯Ø§Ø²Ø´Ú¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
  - `gemini.js` - Proxy Ø¨Ø±Ø§ÛŒ Gemini API
  - `update-tariffs.js` - Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§

**FastAPI Backend** (`/backend`)
- Ø³Ø±ÙˆØ± Python Ù…Ø­Ù„ÛŒ
- Ù¾Ø±Ø¯Ø§Ø²Ø´â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ†
- Worker Ø¨Ø±Ø§ÛŒ job queue
- Ù‚Ø§Ø¨Ù„ÛŒØª Ø§Ø¬Ø±Ø§ Ø±ÙˆÛŒ Windows

#### 3. Data Tier (Ù„Ø§ÛŒÙ‡ Ø¯Ø§Ø¯Ù‡)

**Supabase (PostgreSQL)**
- 4 Ø¬Ø¯ÙˆÙ„ Ø§ØµÙ„ÛŒ
- Realtime subscriptions
- Row-Level Security (RLS)
- Free tier Ø¨Ø§ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 500 MB

**Google Gemini API**
- Ù…Ø¯Ù„: `gemini-2.0-flash`
- ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…ØªÙ†
- JSON mode Ø¨Ø±Ø§ÛŒ structured output

### Ø¬Ø±ÛŒØ§Ù† Ø¯Ø§Ø¯Ù‡ (Data Flow)

```mermaid
graph LR
    A[User Browser] -->|HTTP| B[GitHub Pages]
    A -->|API Calls| C[Netlify Functions]
    C -->|SQL| D[Supabase]
    C -->|HTTP| E[Gemini API]
    B -->|Fetch Data| C
    F[FastAPI Worker] -->|Job Processing| D
```

---

## ğŸ’» Ù¾Ø´ØªÙ‡ ÙÙ†Ø§ÙˆØ±ÛŒ

### Frontend Technologies

| ÙÙ†Ø§ÙˆØ±ÛŒ | Ù†Ø³Ø®Ù‡ | Ú©Ø§Ø±Ø¨Ø±Ø¯ |
|---------|------|--------|
| **Next.js** | 14.2.25 | Framework Ø§ØµÙ„ÛŒ React |
| **React** | 18.3.1 | Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ UI |
| **TypeScript** | 5.9.2 | Type Safety |
| **Tailwind CSS** | 3.4.17 | Styling Ùˆ Ø·Ø±Ø§Ø­ÛŒ |
| **Radix UI** | Latest | Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ÛŒ Accessible |
| **Framer Motion** | 12.23.24 | Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ |
| **React Hook Form** | 7.60.0 | Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ù…â€ŒÙ‡Ø§ |
| **Zod** | 3.25.67 | Validation |

### Visualization Libraries

| Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ | Ú©Ø§Ø±Ø¨Ø±Ø¯ |
|----------|--------|
| **Cytoscape.js** | Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Causal Loop Diagram |
| **Leaflet.js** | Ù†Ù‚Ø´Ù‡â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø§Ù…Ù„ÛŒ |
| **Chart.js** | Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø¢Ù…Ø§Ø±ÛŒ |
| **Recharts** | 2.15.4 | Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ React |

### Backend & Infrastructure

| ÙÙ†Ø§ÙˆØ±ÛŒ | Ù†Ø³Ø®Ù‡ | Ú©Ø§Ø±Ø¨Ø±Ø¯ |
|---------|------|--------|
| **FastAPI** | Latest | Python API Framework |
| **Uvicorn** | Latest | ASGI Server |
| **Netlify Functions** | Latest | Serverless FaaS |
| **Supabase** | Latest | PostgreSQL Database |
| **Node.js** | 22 | Runtime Ù…Ø­ÛŒØ· Development |

### Build & Development Tools

| Ø§Ø¨Ø²Ø§Ø± | Ú©Ø§Ø±Ø¨Ø±Ø¯ |
|-------|--------|
| **npm** | Package Manager |
| **PostCSS** | Ù¾Ø±Ø¯Ø§Ø²Ø´ CSS |
| **CSSNano** | Minification |
| **Terser** | JavaScript Minification |
| **Sharp** | Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ ØªØµØ§ÙˆÛŒØ± |
| **Puppeteer** | E2E Testing |
| **Playwright** | Responsive Testing |

### Deployment & Hosting

| Ø³Ø±ÙˆÛŒØ³ | Ú©Ø§Ø±Ø¨Ø±Ø¯ |
|--------|--------|
| **GitHub Pages** | Static Site Hosting |
| **Netlify** | Serverless Functions |
| **Cloudflare** | CDN Ùˆ Analytics |
| **Vercel Analytics** | Performance Monitoring |

---

## âœ¨ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ

### 1. Water Causal Loop Diagram (CLD)

**Ù…Ø³ÛŒØ±:** `/water/cld/`
**ÙˆØ¶Ø¹ÛŒØª:** Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ (50+ Ù…Ø§Ú˜ÙˆÙ„)

**Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:**
- Ù†Ù…Ø§ÛŒØ´ Ú¯Ø±Ø§Ù ØªØ¹Ø§Ù…Ù„ÛŒ Ø±ÙˆØ§Ø¨Ø· Ø¨Ù‡Ø±Ù‡â€ŒÙˆØ±ÛŒ Ø¢Ø¨
- 50+ Ù…ØªØºÛŒØ± Ù…Ø±ØªØ¨Ø· Ø¨Ø§ Ù…ØµØ±Ù Ø¢Ø¨
- Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø¨Ø§ Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ ØªÙ†Ø¸ÛŒÙ…
- Ø°Ø®ÛŒØ±Ù‡/Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§
- Export Ø¨Ù‡ JSON/PNG
- 6 Ù¾ÛŒØ´â€ŒØªÙ†Ø¸ÛŒÙ…ÛŒ Ø³Ø±ÛŒØ¹ (Quick Presets)

**Ù…Ø¹Ù…Ø§Ø±ÛŒ:**
```
water-cld/
â”œâ”€â”€ kernel.js (96 lines) - Event system
â”œâ”€â”€ mapper.js (104 lines) - Data mapping
â”œâ”€â”€ init.js - Bootstrap
â”œâ”€â”€ scenarios.js - Save/Load
â”œâ”€â”€ quick-preset.js - Presets
â””â”€â”€ 45+ Ù…Ø§Ú˜ÙˆÙ„ Ø¯ÛŒÚ¯Ø±
```

**Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§:**
- Bundle Size: 115 KB â†’ 31 KB (Brotli) = **73% Ú©Ø§Ù‡Ø´**
- Modular Architecture: Core/UI/Loader Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
- Lazy Loading Ø¨Ø±Ø§ÛŒ Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ†
- Pre-compression (gzip/brotli)

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ:**
- `docs/assets/cld/core/index.js` - Facade pattern
- `docs/assets/cld/core/mapper.js` - Node/Edge mapping
- `docs/assets/cld/core/inject.js` - ØªØ²Ø±ÛŒÙ‚ Ø¨Ù‡ Cytoscape
- `docs/assets/cld/core/validate.js` - Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ Ø¯Ø§Ø¯Ù‡

### 2. Amaayesh (Ù†Ù‚Ø´Ù‡ Ø¢Ù…Ø§ÛŒØ´ Ø§Ù†Ø±Ú˜ÛŒ)

**Ù…Ø³ÛŒØ±:** `/amaayesh/`
**ÙˆØ¶Ø¹ÛŒØª:** Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Phase 1-5 Ú©Ø§Ù…Ù„ Ø´Ø¯Ù‡

**Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:**
- Ù†Ù…Ø§ÛŒØ´ Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒØŒ Ø¨Ø§Ø¯ÛŒØŒ Ø³Ø¯Ù‡Ø§
- ÙÛŒÙ„ØªØ± Ø¨Ø±Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ùˆ Ø¸Ø±ÙÛŒØª
- Info Panel Ø¨Ø±Ø§ÛŒ Ø¬Ø²Ø¦ÛŒØ§Øª
- Legend Ù‚Ø§Ø¨Ù„ Ø¬Ù…Ø¹â€ŒØ´Ø¯Ù†
- Fullscreen Mode
- Welcome Tour Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯

**Ù„Ø§ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ GeoJSON:**
- `counties.geojson` - Ù…Ø±Ø²Ù‡Ø§ÛŒ Ø´Ù‡Ø±Ø³ØªØ§Ù†â€ŒÙ‡Ø§
- `wind_sites.geojson` - Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø¯ÛŒ
- `solar_sites.geojson` - Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ±Ø´ÛŒØ¯ÛŒ
- `dams.geojson` - Ø³Ø¯Ù‡Ø§ÛŒ Ø§Ø³ØªØ§Ù†

**Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±:**
- âœ… CSP Compliance (dd74dce)
- âœ… CLS < 0.1 (a391aea)
- âœ… LCP Ø¨Ù‡Ø¨ÙˆØ¯ 2.5 Ø«Ø§Ù†ÛŒÙ‡â€ŒØ§ÛŒ (c56ea62)
- âœ… GeoJSON Ú©Ø§Ù‡Ø´ 80% (67638c5)
- âœ… Serial â†’ Parallel Loading (7c02c60)

**Ù…Ø´Ú©Ù„Ø§Øª Ø¨Ø±Ø·Ø±Ù Ø´Ø¯Ù‡:**
- Ø±ÙØ¹ Ø®Ø·Ø§ÛŒ "L is not defined"
- Ø±ÙØ¹ 404 Ø¨Ø±Ø§ÛŒ GeoJSON
- Ù…Ø´Ú©Ù„ Ú©Ù„ÛŒÚ© Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
- inline styles Ø¨Ø±Ø§ÛŒ CSP

### 3. Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒÚ¯Ø±Ù‡Ø§ÛŒ Ù‡Ø²ÛŒÙ†Ù‡

**Water Cost Calculator**
- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù…ØµØ±Ù (Ù…ØªØ± Ù…Ú©Ø¹Ø¨)
- ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ù¾Ù„Ú©Ø§Ù†ÛŒ
- Ù†Ù…Ø§ÛŒØ´ Ø¢Ù…Ø§Ø± Ù…ØµØ±Ù

**Electricity Cost Calculator**
- Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ kWh
- ØªØ¹Ø±ÙÙ‡â€ŒÙ‡Ø§ÛŒ Ø®Ø±ÛŒØ¯/ÙØ±ÙˆØ´
- PPA (Power Purchase Agreement)

### 4. Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯Ù‡Ø§ÛŒ ØªØ­Ù„ÛŒÙ„ÛŒ

**Ù…Ø³ÛŒØ±:** `/dash/pages/`

**Ù…Ø­ØªÙˆØ§:**
- `/water/` - Ø¨Ø­Ø±Ø§Ù† Ø¢Ø¨ØŒ Ø³Ø¯Ù‡Ø§ØŒ Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ
- `/electricity/` - Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø±Ù‚ØŒ Ú©ÛŒÙÛŒØª
- `/gas/` - ØªØ­Ù„ÛŒÙ„ Ú¯Ø§Ø²
- `/oil/` - ØªØ­Ù„ÛŒÙ„ Ù†ÙØª

**Ú©Ø§Ù…Ù¾ÙˆÙ†Ù†Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø´ØªØ±Ú©:**
- `Card` - Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ
- `Header` - Ù‡Ø¯Ø± ØµÙØ­Ø§Øª
- `Footer` - ÙÙˆØªØ±
- `Chart` - Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§

### 5. AI Integration (Gemini)

**Endpoint:** `POST /api/gemini`

**Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§:**
- Ù¾Ø±Ø³Ø´ Ùˆ Ù¾Ø§Ø³Ø® Ù‡ÙˆØ´Ù…Ù†Ø¯
- ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ JSON
- ØªÙˆÙ„ÛŒØ¯ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª
- Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ

**Ù…Ø¯Ù„:** `gemini-2.0-flash-exp`

**Ù†Ù…ÙˆÙ†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡:**
```javascript
const response = await fetch('/api/gemini', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    q: 'ØªØ­Ù„ÛŒÙ„ Ø§ÛŒÙ† Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¢Ø¨',
    data: { /* scenario data */ }
  })
});
```

### 6. Scenario Management

**Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆ:**
```javascript
POST /api/save-scenario
Body: { state: { /* user parameters */ } }
Response: { id: "uuid", created_at: "..." }
```

**Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø³Ù†Ø§Ø±ÛŒÙˆ:**
```javascript
GET /api/get-scenario?id=uuid
Response: { id: "uuid", state: {...}, created_at: "..." }
```

### 7. SEO & Analytics

**SEO:**
- Schema.org Breadcrumbs
- Open Graph tags
- Twitter Cards
- Sitemap.xml
- robots.txt
- Canonical URLs

**Analytics:**
- Vercel Analytics
- Cloudflare Web Analytics
- Custom RUM (Real User Monitoring)
- Performance Metrics tracking

---

## ğŸ“‚ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø±ÙˆÚ˜Ù‡

```
zero-day-of-water2/
â”‚
â”œâ”€â”€ ğŸ“ app/                          # Next.js Application
â”‚   â”œâ”€â”€ layout.tsx                   # Root Layout
â”‚   â”œâ”€â”€ page.tsx                     # ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
â”‚   â”œâ”€â”€ globals.css                  # Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Global
â”‚   â”œâ”€â”€ robots.ts                    # ØªÙˆÙ„ÛŒØ¯ robots.txt
â”‚   â””â”€â”€ sitemap.ts                   # ØªÙˆÙ„ÛŒØ¯ sitemap.xml
â”‚
â”œâ”€â”€ ğŸ“ components/                   # React Components
â”‚   â”œâ”€â”€ hero/                        # Hero Sections
â”‚   â”œâ”€â”€ sections/                    # Page Sections
â”‚   â”œâ”€â”€ analytics/                   # Analytics Components
â”‚   â””â”€â”€ ui/                          # Radix UI Components
â”‚
â”œâ”€â”€ ğŸ“ backend/                      # FastAPI Backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py                  # FastAPI App
â”‚   â”‚   â””â”€â”€ worker.py                # Background Worker
â”‚   â””â”€â”€ .env.example                 # Ù†Ù…ÙˆÙ†Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
â”‚
â”œâ”€â”€ ğŸ“ netlify/functions/            # Serverless Functions
â”‚   â”œâ”€â”€ save-scenario.js
â”‚   â”œâ”€â”€ get-scenario.js
â”‚   â”œâ”€â”€ get-tariff.js
â”‚   â”œâ”€â”€ cld-submit.js
â”‚   â”œâ”€â”€ cld-result.js
â”‚   â”œâ”€â”€ cld-worker.js
â”‚   â”œâ”€â”€ gemini.js
â”‚   â”œâ”€â”€ update-tariffs.js
â”‚   â””â”€â”€ lib/
â”‚       â””â”€â”€ supabase.js              # Supabase Client
â”‚
â”œâ”€â”€ ğŸ“ docs/                         # GitHub Pages (Static Site)
â”‚   â”œâ”€â”€ index.html                   # ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ water/cld/                # Water CLD
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ ... (50+ modules)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ amaayesh/                 # Ù†Ù‚Ø´Ù‡ Ø¢Ù…Ø§ÛŒØ´
â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â””â”€â”€ data/                    # GeoJSON files
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ assets/
â”‚   â”‚   â”œâ”€â”€ css/                     # Stylesheets
â”‚   â”‚   â”œâ”€â”€ css-bundles/             # CSS Bundles
â”‚   â”‚   â”œâ”€â”€ css-bundles-dist/        # Minified Bundles
â”‚   â”‚   â”œâ”€â”€ dist/                    # Built Assets
â”‚   â”‚   â”œâ”€â”€ cld/                     # CLD Modules
â”‚   â”‚   â”‚   â”œâ”€â”€ core/                # Core (Facade)
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                  # UI Components
â”‚   â”‚   â”‚   â””â”€â”€ loader/              # Bootstrap
â”‚   â”‚   â””â”€â”€ vendor/                  # Third-party libs
â”‚   â”‚
â”‚   â””â”€â”€ _headers                     # Netlify Headers
â”‚
â”œâ”€â”€ ğŸ“ dash/                         # Vanilla JS Dashboards
â”‚   â”œâ”€â”€ components/                  # Shared Components
â”‚   â””â”€â”€ pages/
â”‚       â”œâ”€â”€ water/                   # Water Dashboards
â”‚       â”œâ”€â”€ electricity/
â”‚       â”œâ”€â”€ gas/
â”‚       â””â”€â”€ oil/
â”‚
â”œâ”€â”€ ğŸ“ tests/                        # Test Suites
â”‚   â”œâ”€â”€ e2e/                         # E2E Tests
â”‚   â”‚   â”œâ”€â”€ cld-smoke.js
â”‚   â”‚   â”œâ”€â”€ cld-diagnose.js
â”‚   â”‚   â””â”€â”€ csp-violations.js
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â””â”€â”€ mapper.test.js
â”‚   â””â”€â”€ specs/                       # Playwright Tests
â”‚       â”œâ”€â”€ responsive.spec.ts
â”‚       â””â”€â”€ solar-plant.spec.ts
â”‚
â”œâ”€â”€ ğŸ“ scripts/                      # Build Scripts
â”‚   â”œâ”€â”€ build-cld.js                 # CLD Bundle Builder
â”‚   â”œâ”€â”€ compress-assets.sh           # Asset Compression
â”‚   â””â”€â”€ copy-next-to-docs.js         # Next.js Export Copy
â”‚
â”œâ”€â”€ ğŸ“ tools/                        # Development Tools
â”‚   â”œâ”€â”€ build_wind_geojson.py        # Wind Data Builder
â”‚   â”œâ”€â”€ audit_amaayesh.js            # Map Audit
â”‚   â”œâ”€â”€ cld-inventory.js             # CLD File Inventory
â”‚   â””â”€â”€ verify_publish_paths.js      # CDN Verification
â”‚
â”œâ”€â”€ ğŸ“ .github/workflows/            # CI/CD
â”‚   â”œâ”€â”€ ci.yml                       # Main CI Pipeline
â”‚   â”œâ”€â”€ cld-check.yml                # CLD Checks
â”‚   â”œâ”€â”€ csp-inline-style-check.yml   # CSP Compliance
â”‚   â””â”€â”€ pages.yml                    # GitHub Pages Deploy
â”‚
â”œâ”€â”€ package.json                     # Dependencies & Scripts
â”œâ”€â”€ next.config.js                   # Next.js Config
â”œâ”€â”€ tailwind.config.js               # Tailwind Config
â”œâ”€â”€ tsconfig.json                    # TypeScript Config
â”œâ”€â”€ netlify.toml                     # Netlify Config
â”œâ”€â”€ postcss.docs.config.js           # PostCSS Config
â”‚
â””â”€â”€ ğŸ“„ Documentation
    â”œâ”€â”€ README.md
    â”œâ”€â”€ API_DOCUMENTATION.md
    â”œâ”€â”€ DEPLOYMENT.md
    â”œâ”€â”€ ARCHITECTURE.md
    â””â”€â”€ COMPREHENSIVE_DOCUMENTATION_FA.md (Ø§ÛŒÙ† ÙØ§ÛŒÙ„)
```

---

## âš ï¸ Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ

### 1. Ù…Ø´Ú©Ù„Ø§Øª Performance

#### âŒ LCP (Largest Contentful Paint)
**ÙˆØ¶Ø¹ÛŒØª:** Ø¨Ù‡Ø¨ÙˆØ¯ ÛŒØ§ÙØªÙ‡ Ø§Ù…Ø§ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ø§Ø± Ø¨ÛŒØ´ØªØ±

**Ú©Ø§Ù…ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·:**
- `c56ea62` - Phase 4+5 LCP optimization (2.5s improvement)
- `67638c5` - GeoJSON reduction 80%

**Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡:**
- Preconnect hints Ø¨Ù‡ CDNÙ‡Ø§
- Font preloading
- CSS waterfall elimination
- Parallel loading

**Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡:**
- [ ] Image optimization Ø¨Ø§ Sharp
- [ ] Service Worker Ø¨Ø±Ø§ÛŒ caching
- [ ] Resource hints (preload/prefetch)

#### âŒ CLS (Cumulative Layout Shift)
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ø­Ù„ Ø´Ø¯Ù‡ (< 0.1)

**Ú©Ø§Ù…ÛŒØª:** `a391aea` - CSS Containment API + explicit dimensions

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```css
.map-container {
  contain: layout;
  width: 100%;
  height: 600px;
}
```

### 2. Ù…Ø´Ú©Ù„Ø§Øª CSP (Content Security Policy)

#### âŒ Inline Styles
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ø­Ù„ Ø´Ø¯Ù‡

**Ú©Ø§Ù…ÛŒØª:** `dd74dce` - Move inline styles to CSS file

**Ù‚Ø¨Ù„:**
```html
<div style="position: relative; width: 100%;">
```

**Ø¨Ø¹Ø¯:**
```html
<div class="map-container">
```

**ÙØ§ÛŒÙ„ CSS:** `docs/assets/css/map-inline.css`

**GitHub CI:**
- Workflow: `.github/workflows/csp-inline-style-check.yml`
- Ø¨Ø±Ø±Ø³ÛŒ ØªØ¹Ø¯Ø§Ø¯ inline styles
- Ø®Ø·Ø§ Ø§Ú¯Ø± Ø¨ÛŒØ´ Ø§Ø² baseline

### 3. Ù…Ø´Ú©Ù„Ø§Øª JavaScript

#### âŒ "L is not defined"
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ø­Ù„ Ø´Ø¯Ù‡

**Ú©Ø§Ù…ÛŒØª:** `b62672b` - Fix variable scope

**Ø¹Ù„Øª:** Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Leaflet Ù‚Ø¨Ù„ Ø§Ø² Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```javascript
// Ù‚Ø¨Ù„
const map = L.map('map');

// Ø¨Ø¹Ø¯
document.addEventListener('DOMContentLoaded', () => {
  if (typeof L !== 'undefined') {
    const map = L.map('map');
  }
});
```

#### âŒ 404 GeoJSON Requests
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ø­Ù„ Ø´Ø¯Ù‡

**Ú©Ø§Ù…ÛŒØª:** `b62672b`

**Ø¹Ù„Øª:** Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ù†Ø³Ø¨ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```javascript
// Ù‚Ø¨Ù„
fetch('./data/counties.geojson')

// Ø¨Ø¹Ø¯
fetch('/data/amaayesh/counties.geojson')
```

### 4. Ù…Ø´Ú©Ù„Ø§Øª Mobile

#### âŒ Ø¹Ø¯Ù… Ù‚Ø§Ø¨Ù„ÛŒØª Ú©Ù„ÛŒÚ© Ø¯Ø± Ù…ÙˆØ¨Ø§ÛŒÙ„
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ø­Ù„ Ø´Ø¯Ù‡

**Ú©Ø§Ù…ÛŒØª:** `9403a42` - Fix mobile clickability

**Ø¹Ù„Øª:** z-index Ùˆ overlay conflicts

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```css
.overlay {
  z-index: 999;
  pointer-events: auto;
}

.map-controls {
  z-index: 1000;
  pointer-events: auto;
}
```

### 5. Ù…Ø´Ú©Ù„Ø§Øª Ù…Ø¹Ù…Ø§Ø±ÛŒ CLD

#### âš ï¸ ØªØ²Ø±ÛŒÙ‚ ØºÛŒØ±ÛŒÚ©Ù†ÙˆØ§Ø®Øª Ø¨Ù‡ Cytoscape
**ÙˆØ¶Ø¹ÛŒØª:** ğŸ”„ Ø¯Ø± Ø­Ø§Ù„ Ø±ÙØ¹ (Architecture Refactor A1)

**Ù…Ø´Ú©Ù„:**
- Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…Ø®ØªÙ„Ø· Ø§Ø² `cy.add()` Ùˆ `cy.json({elements})`
- Ú©Ø¯ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡ Ø¯Ø± 50+ ÙØ§ÛŒÙ„

**Ù‡Ø¯Ù:**
- **Golden Rule:** ÙÙ‚Ø· `cy.add(array)` Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯
- Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ Ø¨Ù‡ Core/UI/Loader
- Facade pattern Ø¨Ø±Ø§ÛŒ API ÛŒÚ©Ù†ÙˆØ§Ø®Øª

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ:**
- `docs/assets/cld/core/index.js` - Facade
- `docs/assets/cld/core/inject.js` - ØªØ²Ø±ÛŒÙ‚ ÛŒÚ©Ù†ÙˆØ§Ø®Øª
- `ARCHITECTURE.md` - Ø·Ø±Ø§Ø­ÛŒ Ù‡Ø¯Ù

**Ù¾ÛŒØ´Ø±ÙØª:**
- âœ… Core facade Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡
- âœ… Injection module Ø¬Ø¯Ø§ Ø´Ø¯Ù‡
- âœ… CI guard Ø¨Ø±Ø§ÛŒ `cy.json({elements})` Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯Ù‡
- â³ Refactor 50+ ÙØ§ÛŒÙ„ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡

### 6. Ù…Ø´Ú©Ù„Ø§Øª Database

#### âš ï¸ Supabase Free Tier Limits
**Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§:**
- 500 MB ÙØ¶Ø§
- 2 GB Transfer/Ù…Ø§Ù‡
- Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² 1 Ù‡ÙØªÙ‡ inactivity Ù…ØªÙˆÙ‚Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯

**Ø±Ø§Ù‡â€ŒØ­Ù„â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:**
- [ ] ØªÙ†Ø¸ÛŒÙ… cron job Ø¨Ø±Ø§ÛŒ keep-alive
- [ ] Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² localStorage Ø¨Ø±Ø§ÛŒ cache
- [ ] Ù…Ù‡Ø§Ø¬Ø±Øª Ø¨Ù‡ Postgres Ø®ÙˆØ¯Ù…ÛŒØ²Ø¨Ø§Ù† Ø§Ú¯Ø± Ù†ÛŒØ§Ø² Ø´Ø¯

#### âš ï¸ Ø¹Ø¯Ù… Row-Level Security (RLS)
**ÙˆØ¶Ø¹ÛŒØª:** âš ï¸ ØºÛŒØ±ÙØ¹Ø§Ù„

**Ø±ÛŒØ³Ú©:** Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ù‡Ù…Ù‡ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```sql
-- ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ RLS
ALTER TABLE scenarios ENABLE ROW LEVEL SECURITY;

-- Policy: Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ÙÙ‚Ø· Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø¨ÛŒÙ†Ù†Ø¯
CREATE POLICY "Users can view own scenarios"
ON scenarios FOR SELECT
USING (auth.uid() = user_id);
```

**Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ÛŒ:**
- [ ] Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³ØªÙˆÙ† `user_id`
- [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Authentication
- [ ] Ø§ÛŒØ¬Ø§Ø¯ RLS Policies

### 7. Ù…Ø´Ú©Ù„Ø§Øª Testing

#### âš ï¸ Coverage Ù¾Ø§ÛŒÛŒÙ†
**ÙˆØ¶Ø¹ÛŒØª:** Coverage < 30%

**ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯:**
- âœ… Mapper unit tests
- âœ… CLD smoke tests
- âœ… CSP violation checks
- âœ… Responsive tests (Playwright)

**ØªØ³Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù‚Øµ:**
- âŒ API endpoints unit tests
- âŒ Integration tests
- âŒ Visual regression tests

**Ø±Ø§Ù‡â€ŒØ­Ù„:**
```bash
# Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Jest
npm install --save-dev jest @types/jest

# Coverage report
npm test -- --coverage
```

### 8. Ù…Ø´Ú©Ù„Ø§Øª Documentation

#### âš ï¸ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡
**Ù…Ø´Ú©Ù„:** 40+ ÙØ§ÛŒÙ„ MD Ø¯Ø± Ù…Ú©Ø§Ù†â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯:**
- `README.md`
- `API_DOCUMENTATION.md`
- `DEPLOYMENT.md`
- `ARCHITECTURE.md`
- `docs/PERFORMANCE_OPTIMIZATIONS.md`
- `docs/amaayesh/IMPROVEMENTS.md`
- `REPORTS/*.md` (5+ files)
- Ùˆ ...

**Ø±Ø§Ù‡â€ŒØ­Ù„ (Ø§ÛŒÙ† ÙØ§ÛŒÙ„):**
- âœ… Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¬Ø§Ù…Ø¹ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡
- Ù…Ø±Ø¬Ø¹ Ù…Ø±Ú©Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª

---

## ğŸš€ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯Ù‡

### 1. Pre-compression (gzip/brotli)

**Ù‡Ø¯Ù:** Ú©Ø§Ù‡Ø´ Ø­Ø¬Ù… Ø§Ù†ØªÙ‚Ø§Ù„ Ø¯Ø§Ø¯Ù‡

**Ù†ØªØ§ÛŒØ¬:**

| Asset | Ø§ØµÙ„ÛŒ | Brotli | Ú©Ø§Ù‡Ø´ |
|-------|------|--------|-------|
| water-cld.bundle.js | 115 KB | 31 KB | **73%** â†“ |
| water-cld.bundle.css | 21 KB | 4.4 KB | **78%** â†“ |

**Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ:**
```bash
# Script: scripts/compress-assets.sh
find docs/assets/dist -type f \( -name "*.js" -o -name "*.css" \) | while read file; do
  gzip -9 -k "$file"
  brotli -9 -k "$file"
done
```

**Headers:**
```
# docs/_headers
/assets/dist/*.js.br
  Content-Type: application/javascript
  Content-Encoding: br
  Cache-Control: public, max-age=31536000, immutable
```

**Automatic:** Ø¨Ø¹Ø¯ Ø§Ø² Ù‡Ø± `npm run build`

### 2. CSS Optimization Pipeline

**Ù…Ø±Ø§Ø­Ù„:**

```
1. Tailwind Compile
   tailwind.input.css â†’ tailwind.css

2. PostCSS Processing
   autoprefixer + optimization

3. CSSNano Minification
   comments removal + minify

4. Bundling
   core.bundle.css + layout.bundle.css

5. Compression
   .gz + .br generation
```

**Ù†ØªÛŒØ¬Ù‡:**
- Bundle Size: 95 KB â†’ 21 KB (78% Ú©Ø§Ù‡Ø´)
- Critical CSS Ø¬Ø¯Ø§ Ø´Ø¯Ù‡
- Render-blocking Ú©Ø§Ù‡Ø´ ÛŒØ§ÙØªÙ‡

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:**
- `postcss.docs.config.js` - ØªÙ†Ø¸ÛŒÙ…Ø§Øª
- `docs/assets/css-bundles/` - Source bundles
- `docs/assets/css-bundles-dist/` - Minified bundles

### 3. GeoJSON Optimization

**Ù‚Ø¨Ù„:**
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [59.123456789, 36.123456789],
          [59.234567890, 36.234567890],
          ...
        ]]
      },
      "properties": {
        "name_fa": "Ø´Ù‡Ø±Ø³ØªØ§Ù† Ù…Ø´Ù‡Ø¯",
        "name_en": "Mashhad County",
        "population": 3001184,
        "area_km2": 9846,
        "density": 304.8,
        ...
      }
    }
  ]
}
```

**Ø¨Ø¹Ø¯:**
```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Polygon",
        "coordinates": [[
          [59.12, 36.12],
          [59.23, 36.23],
          ...
        ]]
      },
      "properties": {
        "n": "Ù…Ø´Ù‡Ø¯",
        "p": 3001184
      }
    }
  ]
}
```

**Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒâ€ŒÙ‡Ø§:**
1. **Precision Ú©Ø§Ù‡Ø´:** 9 decimal â†’ 2 decimal
2. **Property keys Ú©ÙˆØªØ§Ù‡â€ŒØªØ±:** `name_fa` â†’ `n`
3. **Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ØºÛŒØ±Ø¶Ø±ÙˆØ±ÛŒ**
4. **Minification**

**Ù†ØªÛŒØ¬Ù‡:**
- `counties.geojson`: 245 KB â†’ 49 KB (80% â†“)
- `wind_sites.geojson`: 128 KB â†’ 26 KB (80% â†“)
- `solar_sites.geojson`: 95 KB â†’ 19 KB (80% â†“)

### 4. Parallel Loading Strategy

**Ù‚Ø¨Ù„ (Serial):**
```javascript
// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø³Ø±ÛŒØ§Ù„ÛŒ - Ú©Ù†Ø¯
async function loadMap() {
  await loadLeaflet();
  await loadCounties();
  await loadWindSites();
  await loadSolarSites();
  await loadDams();
  // Total: 1200ms
}
```

**Ø¨Ø¹Ø¯ (Parallel):**
```javascript
// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…ÙˆØ§Ø²ÛŒ - Ø³Ø±ÛŒØ¹
async function loadMap() {
  const [leaflet, counties, wind, solar, dams] = await Promise.all([
    loadLeaflet(),
    loadCounties(),
    loadWindSites(),
    loadSolarSites(),
    loadDams()
  ]);
  // Total: 350ms
}
```

**Ù†ØªÛŒØ¬Ù‡:**
- Load Time: 1200ms â†’ 350ms (71% â†“)

### 5. Caching Strategy

**Static Assets (Immutable):**
```
/assets/*
  Cache-Control: public, max-age=31536000, immutable
```

**Data Files (Revalidate):**
```
/data/*.json
  Cache-Control: public, max-age=3600, stale-while-revalidate=86400
```

**Ù…Ø²Ø§ÛŒØ§:**
- âœ… Ø¨Ø¯ÙˆÙ† network request Ø¨Ø±Ø§ÛŒ assets
- âœ… Update Ø¯Ø± Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¨Ø±Ø§ÛŒ data
- âœ… Hit Rate: 60% â†’ 90%

### 6. Font Optimization

**Ù‚Ø¨Ù„:**
```html
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
```

**Ø¨Ø¹Ø¯:**
```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="dns-prefetch" href="https://fonts.googleapis.com">
<link rel="preload" href="/fonts/vazirmatn-regular.woff2" as="font" type="font/woff2" crossorigin>
```

**Ù†ØªÛŒØ¬Ù‡:**
- FOIT (Flash of Invisible Text) Ø­Ø°Ù Ø´Ø¯Ù‡
- Font load: 400ms â†’ 80ms

### 7. Code Splitting (CLD Modules)

**Ù…Ø¹Ù…Ø§Ø±ÛŒ Ù…Ø§Ú˜ÙˆÙ„Ø§Ø±:**

```
Core (Ù‡Ù…ÛŒØ´Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ):
â”œâ”€â”€ validate.js (2 KB)
â”œâ”€â”€ mapper.js (3 KB)
â”œâ”€â”€ inject.js (1 KB)
â””â”€â”€ index.js (4 KB)
Total: 10 KB

UI (Lazy Load):
â”œâ”€â”€ controls.js (8 KB)
â”œâ”€â”€ legend.js (5 KB)
â””â”€â”€ search.js (6 KB)
Total: 19 KB (loaded on demand)
```

**Ù†ØªÛŒØ¬Ù‡:**
- Initial Load: 115 KB â†’ 10 KB
- Time to Interactive: 1500ms â†’ 400ms

### 8. Image Optimization

**Ù†Ù…ÙˆÙ†Ù‡:**
```javascript
// Sharp optimization
const sharp = require('sharp');

await sharp('hero.jpg')
  .resize(1920, 1080, { fit: 'cover' })
  .webp({ quality: 80 })
  .toFile('hero.webp');

await sharp('hero.jpg')
  .resize(1920, 1080, { fit: 'cover' })
  .jpeg({ quality: 85, progressive: true })
  .toFile('hero.jpg');
```

**Format Fallback:**
```html
<picture>
  <source srcset="/images/hero.webp" type="image/webp">
  <source srcset="/images/hero.jpg" type="image/jpeg">
  <img src="/images/hero.jpg" alt="Hero">
</picture>
```

### 9. Performance Monitoring (RUM)

**Real User Monitoring:**

```javascript
// docs/assets/cld/perf/rum.js
window.RUM = {
  collect() {
    const nav = performance.getEntriesByType('navigation')[0];
    const paint = performance.getEntriesByType('paint');

    return {
      ttfb: nav.responseStart - nav.requestStart,
      fcp: paint.find(p => p.name === 'first-contentful-paint')?.startTime,
      domInteractive: nav.domInteractive,
      loadComplete: nav.loadEventEnd
    };
  },

  send(metrics) {
    navigator.sendBeacon('/api/metrics', JSON.stringify(metrics));
  }
};
```

**Metrics Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ:**
- TTFB (Time to First Byte)
- FCP (First Contentful Paint)
- LCP (Largest Contentful Paint)
- FID (First Input Delay)
- CLS (Cumulative Layout Shift)

---

## ğŸ› ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡

### Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§

```bash
# Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²
Node.js: >= 22 < 23
npm: >= 9
Python: >= 3.9 (Ø¨Ø±Ø§ÛŒ FastAPI backend)
Git: Latest
```

### Ù†ØµØ¨ Ø§ÙˆÙ„ÛŒÙ‡

```bash
# 1. Clone repository
git clone https://github.com/sajjadzea/zero-day-of-water2.git
cd zero-day-of-water2

# 2. Ù†ØµØ¨ dependencies
npm install

# 3. ØªÙ†Ø¸ÛŒÙ… environment variables
cp .env.example .env
# ÙˆÛŒØ±Ø§ÛŒØ´ .env Ùˆ Ø§ÙØ²ÙˆØ¯Ù† API keys

# 4. Build CSS
npm run build:css

# 5. Build Next.js
npm run build:next
```

### Development Server

```bash
# Next.js dev server (port 3000)
npm run dev

# Netlify Functions dev (port 8888)
npx netlify dev

# Static site server (port 5173)
npm run serve-docs

# FastAPI backend (port 8010)
cd backend
uvicorn app.main:app --reload --host 127.0.0.1 --port 8010
```

### Build Pipeline

```bash
# Full production build
npm run build

# Ø§ÛŒÙ† Ø¯Ø³ØªÙˆØ± Ø´Ø§Ù…Ù„:
# 1. Tailwind CSS compile
# 2. CSS optimization
# 3. CSS bundling
# 4. Agrivoltaics build
# 5. Next.js build
# 6. Copy to docs
# 7. Asset compression (gzip/brotli)
```

### ØªØ³Øªâ€ŒÙ‡Ø§

```bash
# All tests
npm test

# Unit tests
npm run test:unit:mapper

# E2E smoke test
npm run e2e:smoke

# CSP violations check
npm run e2e:csp:fast

# Responsive tests (Playwright)
npm run audit:responsive

# TypeScript check
npm run ts:check
```

### Linting & Code Quality

```bash
# ESLint
npm run lint

# CSP inline style scan
npm run csp:scan

# Encoding audit
npm run audit:encoding
```

### Build Scripts Ù…Ù‡Ù…

| Script | Ú©Ø§Ø±Ø¨Ø±Ø¯ |
|--------|--------|
| `npm run build:css` | Compile Tailwind CSS |
| `npm run optimize:css` | PostCSS + CSSNano |
| `npm run bundle:css` | Create CSS bundles |
| `npm run build:cld` | Build CLD bundle |
| `npm run compress` | gzip/brotli compression |
| `npm run verify:publish` | CDN availability check |

### Debugging

```bash
# CLD diagnostics
npm run diag:cld

# CLD file inventory
npm run audit:cld:files

# CLD runtime usage
npm run audit:cld:runtime

# Amaayesh audit
npm run audit:ama
```

### Git Workflow

```bash
# 1. Create feature branch
git checkout -b feature/new-feature

# 2. Make changes
# ... edit files ...

# 3. Test
npm test
npm run lint

# 4. Build
npm run build

# 5. Commit
git add .
git commit -m "feat: add new feature"

# 6. Push
git push origin feature/new-feature

# 7. Create Pull Request on GitHub
```

### Deployment

**Netlify (Automatic):**
```bash
# Push to main branch
git push origin main

# Netlify automatically:
# 1. Runs build command
# 2. Deploys /docs to GitHub Pages
# 3. Deploys functions to Netlify
```

**Manual Deploy:**
```bash
# Build
npm run build

# Deploy to Netlify
netlify deploy --prod

# Deploy to GitHub Pages
git push origin main
```

### Environment Variables

**Local Development** (`.env`):
```bash
# Gemini API
GEMINI_API_KEY=your_key_here

# Supabase
SUPABASE_URL=https://xxx.supabase.co
SUPABASE_ANON_KEY=your_anon_key

# FastAPI
API_HOST=127.0.0.1
API_PORT=8010
```

**Netlify** (Environment Variables):
```
GEMINI_API_KEY=xxx
SUPABASE_URL=xxx
SUPABASE_ANON_KEY=xxx
PREVIEW_ORIGIN=https://deploy-preview-XXX--site.netlify.app
```

### Code Style

**TypeScript/JavaScript:**
```javascript
// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² async/await
async function fetchData() {
  try {
    const response = await fetch('/api/data');
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('Error:', error);
    throw error;
  }
}

// Named exports
export function helper() { /* ... */ }
export const CONSTANT = 42;

// Type annotations
function process(input: string): number {
  return parseInt(input, 10);
}
```

**CSS:**
```css
/* Tailwind utilities Ø§ÙˆÙ„ÙˆÛŒØª Ø¯Ø§Ø±Ù†Ø¯ */
<div class="flex items-center justify-between p-4">

/* Custom CSS Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² */
.custom-component {
  @apply flex items-center;
  /* custom properties */
  --custom-color: #0ea5e9;
}
```

---

## ğŸ“¡ Ù…Ø³ØªÙ†Ø¯Ø§Øª API

### Base URLs

**Production:**
- Frontend: `https://wesh360.ir`
- API: `https://wesh360.ir/api/`

**Development:**
- Frontend: `http://localhost:3000`
- API (Netlify): `http://localhost:8888/.netlify/functions/`
- API (FastAPI): `http://localhost:8010/api/`

### Authentication

**ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ù„ÛŒ:** ğŸ”“ Ø¨Ø¯ÙˆÙ† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª (Public API)

**Ø¢ÛŒÙ†Ø¯Ù‡:** ğŸ” Supabase Auth

### Endpoints

#### 1. Save Scenario

**Endpoint:** `POST /api/save-scenario`

**Request:**
```json
{
  "state": {
    "variables": {
      "population": 3000000,
      "waterConsumption": 250,
      "...": "..."
    },
    "timestamp": 1704556800000
  }
}
```

**Response:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

**Errors:**
```json
{
  "error": "Invalid state data",
  "details": "..."
}
```

#### 2. Get Scenario

**Endpoint:** `GET /api/get-scenario?id={uuid}`

**Response:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "state": {
    "variables": { "...": "..." }
  },
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

**Errors:**
- `404` - Scenario not found
- `400` - Invalid UUID

#### 3. Get Tariff

**Endpoint:** `GET /api/get-tariff`

**Response:**
```json
{
  "id": "uuid",
  "ppa": 2500,
  "buy": 3000,
  "sell": 1500,
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

#### 4. CLD Submit

**Endpoint:** `POST /api/cld-submit`

**Request:**
```json
{
  "model": {
    "nodes": [
      { "id": "n1", "label": "Population" },
      { "id": "n2", "label": "Water Demand" }
    ],
    "edges": [
      { "source": "n1", "target": "n2", "sign": "+", "weight": 0.8 }
    ]
  },
  "options": {
    "layout": "dagre",
    "format": "json"
  }
}
```

**Response:**
```json
{
  "job_id": "uuid",
  "status": "pending",
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

#### 5. CLD Result

**Endpoint:** `GET /api/cld-result?job_id={uuid}`

**Response (Pending):**
```json
{
  "job_id": "uuid",
  "status": "processing",
  "progress": 45
}
```

**Response (Complete):**
```json
{
  "job_id": "uuid",
  "status": "complete",
  "result": {
    "nodes": [...],
    "edges": [...],
    "layout": {...}
  },
  "created_at": "2025-01-06T10:00:00.000Z",
  "completed_at": "2025-01-06T10:05:00.000Z"
}
```

**Response (Error):**
```json
{
  "job_id": "uuid",
  "status": "error",
  "error": "Invalid model format",
  "details": "..."
}
```

#### 6. Gemini AI

**Endpoint:** `POST /api/gemini`

**Request:**
```json
{
  "q": "ØªØ­Ù„ÛŒÙ„ Ø§ÛŒÙ† Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¢Ø¨",
  "data": {
    "population": 3000000,
    "waterConsumption": 250
  },
  "options": {
    "model": "gemini-2.0-flash",
    "temperature": 0.7,
    "maxTokens": 1000
  }
}
```

**Response:**
```json
{
  "response": "Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ø´Ø¯Ù‡...",
  "usage": {
    "promptTokens": 150,
    "completionTokens": 450,
    "totalTokens": 600
  }
}
```

#### 7. Update Tariffs

**Endpoint:** `POST /api/update-tariffs`

**Request:**
```json
{
  "ppa": 2600,
  "buy": 3100,
  "sell": 1550
}
```

**Response:**
```json
{
  "id": "uuid",
  "ppa": 2600,
  "buy": 3100,
  "sell": 1550,
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

### Rate Limiting

**Netlify Functions:**
- 125,000 requests/month (Free tier)
- 100 hours function runtime/month

**FastAPI:**
- 60 requests/second per IP
- Token bucket algorithm

**Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ:**
```python
# backend/app/main.py
from fastapi import Request
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.post("/api/submit")
@limiter.limit("60/second")
async def submit(request: Request):
    # ...
```

### CORS

**Allowed Origins:**
```javascript
const allowedOrigins = [
  'https://wesh360.ir',
  'https://www.wesh360.ir',
  'https://api.wesh360.ir',
  process.env.URL, // Netlify deploy preview
  process.env.DEPLOY_PRIME_URL
];
```

**Headers:**
```
Access-Control-Allow-Origin: https://wesh360.ir
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
```

### Error Handling

**Standard Error Response:**
```json
{
  "error": "Error type",
  "message": "Human-readable message",
  "details": "Additional details",
  "timestamp": "2025-01-06T10:00:00.000Z",
  "path": "/api/endpoint"
}
```

**HTTP Status Codes:**
- `200` - Success
- `201` - Created
- `204` - No Content
- `400` - Bad Request
- `401` - Unauthorized
- `403` - Forbidden
- `404` - Not Found
- `429` - Too Many Requests
- `500` - Internal Server Error
- `502` - Bad Gateway
- `503` - Service Unavailable

---

## ğŸ—„ï¸ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡

### Schema (Supabase PostgreSQL)

#### Table: `scenarios`

**Ø°Ø®ÛŒØ±Ù‡ Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†**

```sql
CREATE TABLE scenarios (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  state JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index for faster queries
CREATE INDEX idx_scenarios_created_at ON scenarios(created_at DESC);
```

**Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø§Ø¯Ù‡:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "state": {
    "variables": {
      "population": 3000000,
      "waterConsumption": 250,
      "irrigationEfficiency": 0.6,
      "industrialDemand": 50
    },
    "metadata": {
      "name": "Scenario 2030",
      "description": "High efficiency scenario"
    }
  },
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

#### Table: `tariffs`

**Ù†Ø±Ø®â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù‚**

```sql
CREATE TABLE tariffs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ppa NUMERIC(10, 2) NOT NULL,    -- Power Purchase Agreement
  buy NUMERIC(10, 2) NOT NULL,    -- Ø®Ø±ÛŒØ¯ Ø§Ø² Ø´Ø¨Ú©Ù‡
  sell NUMERIC(10, 2) NOT NULL,   -- ÙØ±ÙˆØ´ Ø¨Ù‡ Ø´Ø¨Ú©Ù‡
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Index for latest tariff
CREATE INDEX idx_tariffs_created_at ON tariffs(created_at DESC);
```

**Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø§Ø¯Ù‡:**
```json
{
  "id": "uuid",
  "ppa": 2500.00,
  "buy": 3000.00,
  "sell": 1500.00,
  "created_at": "2025-01-06T10:00:00.000Z"
}
```

#### Table: `cld_jobs`

**Job Queue Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ CLD**

```sql
CREATE TABLE cld_jobs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  model JSONB NOT NULL,
  options JSONB,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  started_at TIMESTAMP WITH TIME ZONE,
  completed_at TIMESTAMP WITH TIME ZONE,

  CONSTRAINT valid_status CHECK (
    status IN ('pending', 'processing', 'complete', 'error')
  )
);

-- Index for pending jobs
CREATE INDEX idx_cld_jobs_status ON cld_jobs(status, created_at);
```

#### Table: `cld_results`

**Ù†ØªØ§ÛŒØ¬ Ù¾Ø±Ø¯Ø§Ø²Ø´ CLD**

```sql
CREATE TABLE cld_results (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  job_id UUID REFERENCES cld_jobs(id) ON DELETE CASCADE,
  result JSONB NOT NULL,
  error TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Foreign key index
CREATE INDEX idx_cld_results_job_id ON cld_results(job_id);
```

### Queries Ù…ØªØ¯Ø§ÙˆÙ„

**Ø¯Ø±ÛŒØ§ÙØª Ø¢Ø®Ø±ÛŒÙ† ØªØ¹Ø±ÙÙ‡:**
```sql
SELECT * FROM tariffs
ORDER BY created_at DESC
LIMIT 1;
```

**Ø¯Ø±ÛŒØ§ÙØª Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¨Ù‡ ID:**
```sql
SELECT * FROM scenarios
WHERE id = '550e8400-e29b-41d4-a716-446655440000';
```

**Ù„ÛŒØ³Øª job Ù‡Ø§ÛŒ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±:**
```sql
SELECT * FROM cld_jobs
WHERE status = 'pending'
ORDER BY created_at ASC;
```

**Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª job:**
```sql
UPDATE cld_jobs
SET status = 'processing', started_at = NOW()
WHERE id = 'job-uuid';
```

### Backup Strategy

**Supabase Automatic Backups:**
- Daily backups (Free tier: 7 days retention)
- Point-in-time recovery (Paid plans)

**Manual Backup:**
```bash
# Export data
pg_dump -h db.xxx.supabase.co -U postgres -d postgres > backup.sql

# Restore
psql -h db.xxx.supabase.co -U postgres -d postgres < backup.sql
```

### Migration Guide

**Ø§ÙØ²ÙˆØ¯Ù† Ø³ØªÙˆÙ† Ø¬Ø¯ÛŒØ¯:**
```sql
-- 1. Add column
ALTER TABLE scenarios
ADD COLUMN user_id UUID;

-- 2. Create index
CREATE INDEX idx_scenarios_user_id ON scenarios(user_id);

-- 3. Update existing data
UPDATE scenarios
SET user_id = 'default-user-uuid'
WHERE user_id IS NULL;

-- 4. Make NOT NULL
ALTER TABLE scenarios
ALTER COLUMN user_id SET NOT NULL;
```

---

## ğŸ” Ø§Ù…Ù†ÛŒØª Ùˆ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§

### Content Security Policy (CSP)

**ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ù„ÛŒ** (`docs/_headers`):

```
/*
  Content-Security-Policy: default-src 'self'; script-src 'self' https://static.cloudflareinsights.com; style-src-elem 'self'; style-src-attr 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://*.supabase.co https://generativelanguage.googleapis.com; frame-ancestors 'none'; base-uri 'self'; form-action 'self';
  X-Frame-Options: DENY
  X-Content-Type-Options: nosniff
  Referrer-Policy: strict-origin-when-cross-origin
  Permissions-Policy: geolocation=(), microphone=(), camera=()
```

**Ø§Ø³ØªØ«Ù†Ø§Ø¡Ø§Øª:**
```
# Relaxed CSP for test pages (Cytoscape needs inline styles)
/test/*
  Content-Security-Policy: default-src 'self'; script-src 'self'; style-src-elem 'self' 'unsafe-inline'; style-src-attr 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https://*.supabase.co;
```

**CI Enforcement:**
```yaml
# .github/workflows/csp-inline-style-check.yml
- name: Check CSP compliance
  run: |
    npm run csp:scan > violations.txt
    if [ -s violations.txt ]; then
      echo "CSP violations found!"
      exit 1
    fi
```

### CORS Security

**Origin Validation:**
```javascript
// netlify/functions/lib/supabase.js
const allowedOrigins = [
  'https://wesh360.ir',
  'https://www.wesh360.ir',
  process.env.URL,
  process.env.DEPLOY_PRIME_URL
];

function validateOrigin(origin) {
  return allowedOrigins.includes(origin);
}
```

**Preflight Handling:**
```javascript
export async function handler(event, context) {
  const origin = event.headers.origin;

  // OPTIONS request
  if (event.httpMethod === 'OPTIONS') {
    if (!validateOrigin(origin)) {
      return { statusCode: 403 };
    }

    return {
      statusCode: 204,
      headers: {
        'Access-Control-Allow-Origin': origin,
        'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
        'Access-Control-Allow-Headers': 'Content-Type'
      }
    };
  }

  // ...
}
```

### Rate Limiting

**Netlify Functions:**
```javascript
// Simple in-memory rate limiter
const requests = new Map();

function checkRateLimit(ip, limit = 60, window = 60000) {
  const now = Date.now();
  const userRequests = requests.get(ip) || [];

  // Ø­Ø°Ù Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
  const recentRequests = userRequests.filter(t => now - t < window);

  if (recentRequests.length >= limit) {
    return false; // Rate limit exceeded
  }

  recentRequests.push(now);
  requests.set(ip, recentRequests);
  return true;
}
```

**FastAPI:**
```python
from slowapi import Limiter, _rate_limit_exceeded_handler
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded

limiter = Limiter(key_func=get_remote_address)
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, _rate_limit_exceeded_handler)

@app.post("/api/submit")
@limiter.limit("60/second")
async def submit(request: Request):
    # ...
```

### Input Validation

**JSON Schema Validation:**
```javascript
const Ajv = require('ajv');
const ajv = new Ajv();

const scenarioSchema = {
  type: 'object',
  required: ['state'],
  properties: {
    state: {
      type: 'object',
      required: ['variables'],
      properties: {
        variables: {
          type: 'object',
          properties: {
            population: { type: 'number', minimum: 0 },
            waterConsumption: { type: 'number', minimum: 0 }
          }
        }
      }
    }
  }
};

const validate = ajv.compile(scenarioSchema);

function validateScenario(data) {
  const valid = validate(data);
  if (!valid) {
    throw new Error(JSON.stringify(validate.errors));
  }
  return true;
}
```

**Zod Validation (Frontend):**
```typescript
import { z } from 'zod';

const scenarioSchema = z.object({
  state: z.object({
    variables: z.object({
      population: z.number().min(0),
      waterConsumption: z.number().min(0),
      irrigationEfficiency: z.number().min(0).max(1)
    })
  })
});

type Scenario = z.infer<typeof scenarioSchema>;

function validateScenario(data: unknown): Scenario {
  return scenarioSchema.parse(data);
}
```

### API Key Security

**âŒ Ø®Ø·Ø§ - Ù‡Ø±Ú¯Ø² Ù†Ú©Ù†ÛŒØ¯:**
```javascript
// NEVER commit API keys!
const GEMINI_API_KEY = 'AIzaSy...';
```

**âœ… Ø¯Ø±Ø³Øª:**
```javascript
// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Environment Variables
const GEMINI_API_KEY = process.env.GEMINI_API_KEY;

if (!GEMINI_API_KEY) {
  throw new Error('GEMINI_API_KEY not set');
}
```

**Netlify Environment Variables:**
1. Dashboard â†’ Site Settings â†’ Environment Variables
2. Add: `GEMINI_API_KEY=your_key`
3. Deploy

### SQL Injection Prevention

**âœ… Supabase Client (Safe):**
```javascript
// Supabase client uses parameterized queries
const { data, error } = await supabase
  .from('scenarios')
  .select('*')
  .eq('id', userInput); // Safe - parameterized
```

**âŒ Raw SQL (Ø®Ø·Ø±Ù†Ø§Ú©):**
```javascript
// NEVER do this!
const query = `SELECT * FROM scenarios WHERE id = '${userInput}'`;
```

### XSS Prevention

**React (Automatic Escaping):**
```jsx
// React automatically escapes
function UserInput({ text }) {
  return <div>{text}</div>; // Safe
}
```

**Vanilla JS (Manual Escaping):**
```javascript
function escapeHtml(unsafe) {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

element.textContent = userInput; // Safe
element.innerHTML = escapeHtml(userInput); // Safe
element.innerHTML = userInput; // âŒ DANGEROUS!
```

### Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§

#### Netlify Free Tier
- âœ… 100 GB Bandwidth/month
- âœ… 125,000 Function requests/month
- âœ… 100 hours Function runtime/month
- âŒ Ø¨Ø¯ÙˆÙ† Environment Variables encryption
- âŒ Ø¨Ø¯ÙˆÙ† Role-based access control

#### Supabase Free Tier
- âœ… 500 MB Database
- âœ… 2 GB Transfer/month
- âœ… 50,000 Monthly Active Users
- âŒ Database pause Ø¨Ø¹Ø¯ Ø§Ø² 1 Ù‡ÙØªÙ‡ inactivity
- âŒ Ø¨Ø¯ÙˆÙ† Point-in-time recovery

#### GitHub Pages
- âœ… 1 GB site size
- âœ… 100 GB Bandwidth/month
- âœ… 10 builds/hour
- âŒ ÙÙ‚Ø· Static content
- âŒ Ø¨Ø¯ÙˆÙ† Server-side processing

#### Google Gemini API Free Tier
- âœ… 15 requests/minute
- âœ… 1,500 requests/day
- âœ… 1 million tokens/month
- âŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª context length

---

## ğŸš¦ Ù†Ù‚Ø´Ù‡ Ø±Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡

### Priority 1 (ÙÙˆØ±ÛŒ)

#### ğŸ” Authentication & Authorization
**Ø²Ù…Ø§Ù† ØªØ®Ù…ÛŒÙ†ÛŒ:** 2 Ù‡ÙØªÙ‡

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Supabase Auth
- [ ] ØµÙØ­Ø§Øª Login/Signup
- [ ] Email verification
- [ ] Password reset
- [ ] Session management
- [ ] Protected routes
- [ ] User profile

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:**
```
app/auth/
â”œâ”€â”€ login/page.tsx
â”œâ”€â”€ signup/page.tsx
â”œâ”€â”€ reset-password/page.tsx
â””â”€â”€ verify-email/page.tsx

lib/auth.ts
components/auth/
â”œâ”€â”€ LoginForm.tsx
â”œâ”€â”€ SignupForm.tsx
â””â”€â”€ AuthGuard.tsx
```

#### ğŸ”’ Row-Level Security (RLS)
**Ø²Ù…Ø§Ù† ØªØ®Ù…ÛŒÙ†ÛŒ:** 1 Ù‡ÙØªÙ‡

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Ø§ÙØ²ÙˆØ¯Ù† `user_id` Ø¨Ù‡ Ø¬Ø¯Ø§ÙˆÙ„
- [ ] Ø§ÛŒØ¬Ø§Ø¯ RLS Policies
- [ ] Migration Ø¨Ø±Ø§ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯
- [ ] ØªØ³Øª Policies

**SQL:**
```sql
-- Add user_id column
ALTER TABLE scenarios ADD COLUMN user_id UUID REFERENCES auth.users(id);

-- Enable RLS
ALTER TABLE scenarios ENABLE ROW LEVEL SECURITY;

-- Policy: Users can only see their own scenarios
CREATE POLICY "Users view own scenarios"
ON scenarios FOR SELECT
USING (auth.uid() = user_id);

-- Policy: Users can insert their own scenarios
CREATE POLICY "Users insert own scenarios"
ON scenarios FOR INSERT
WITH CHECK (auth.uid() = user_id);

-- Policy: Users can update their own scenarios
CREATE POLICY "Users update own scenarios"
ON scenarios FOR UPDATE
USING (auth.uid() = user_id);

-- Policy: Users can delete their own scenarios
CREATE POLICY "Users delete own scenarios"
ON scenarios FOR DELETE
USING (auth.uid() = user_id);
```

#### ğŸ“Š Analytics Dashboard
**Ø²Ù…Ø§Ù† ØªØ®Ù…ÛŒÙ†ÛŒ:** 2 Ù‡ÙØªÙ‡

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] RUM data collection
- [ ] Performance metrics dashboard
- [ ] User behavior tracking
- [ ] Error monitoring
- [ ] Custom events

**Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§:**
- Cloudflare Analytics Engine
- Vercel Analytics
- Custom dashboard Ø¨Ø§ Chart.js

### Priority 2 (Ù…Ù‡Ù…)

#### ğŸš€ Service Worker & PWA
**Ø²Ù…Ø§Ù† ØªØ®Ù…ÛŒÙ†ÛŒ:** 1 Ù‡ÙØªÙ‡

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Service Worker Ø¨Ø±Ø§ÛŒ caching
- [ ] Offline support
- [ ] Web App Manifest
- [ ] Install prompt
- [ ] Push notifications

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§:**
```javascript
// public/sw.js
const CACHE_NAME = 'wesh360-v1';
const urlsToCache = [
  '/',
  '/assets/css/tailwind.css',
  '/assets/dist/water-cld.bundle.js'
];

self.addEventListener('install', event => {
  event.waitUntil(
    caches.open(CACHE_NAME).then(cache => {
      return cache.addAll(urlsToCache);
    })
  );
});

self.addEventListener('fetch', event => {
  event.respondWith(
    caches.match(event.request).then(response => {
      return response || fetch(event.request);
    })
  );
});
```

```json
// public/manifest.json
{
  "name": "wesh360 - Ø¢Ù…Ø§ÛŒØ´ Ù…Ù†Ø§Ø¨Ø¹ Ø¢Ø¨ Ùˆ Ø§Ù†Ø±Ú˜ÛŒ",
  "short_name": "wesh360",
  "description": "Ù¾Ù„ØªÙØ±Ù… ØªØ­Ù„ÛŒÙ„ Ùˆ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ø¢Ø¨ Ùˆ Ø§Ù†Ø±Ú˜ÛŒ",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#0f172a",
  "theme_color": "#0ea5e9",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

#### ğŸ—ºï¸ Ù†Ù‚Ø´Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Amaayesh

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Clustering Ø¨Ø±Ø§ÛŒ Ù†Ù‚Ø§Ø·
- [ ] Heatmap layer
- [ ] ÙÛŒÙ„ØªØ± Ø¸Ø±ÙÛŒØª
- [ ] Search box
- [ ] Export to PNG/PDF
- [ ] Share functionality
- [ ] 3D view (Mapbox GL)

#### ğŸ’¾ Database Improvements

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Indexing optimization
- [ ] Query performance tuning
- [ ] Automatic backups
- [ ] Data archiving
- [ ] Supabase Edge Functions

### Priority 3 (Ø¨Ù‡Ø¨ÙˆØ¯)

#### ğŸ¤– AI Features

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Scenario suggestions Ø¨Ø§ AI
- [ ] Anomaly detection
- [ ] Predictive analytics
- [ ] Natural language queries
- [ ] Auto-complete for searches

**Ù…Ø«Ø§Ù„:**
```javascript
// AI-powered scenario suggestions
async function getSuggestions(currentScenario) {
  const response = await fetch('/api/gemini', {
    method: 'POST',
    body: JSON.stringify({
      q: 'Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ 3 Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¨Ù‡ÛŒÙ†Ù‡ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§ÛŒÙ† Ø¯Ø§Ø¯Ù‡',
      data: currentScenario,
      options: {
        temperature: 0.8,
        maxTokens: 1500
      }
    })
  });

  const { response: suggestions } = await response.json();
  return suggestions;
}
```

#### ğŸ“ˆ Advanced Visualizations

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] D3.js charts
- [ ] Real-time updates
- [ ] Animated transitions
- [ ] Interactive legends
- [ ] Custom tooltips
- [ ] Export charts

#### ğŸŒ Multi-language Support

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] i18n setup (next-i18next)
- [ ] ØªØ±Ø¬Ù…Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
- [ ] RTL/LTR switching
- [ ] Language selector
- [ ] Localized dates/numbers

**Ø³Ø§Ø®ØªØ§Ø±:**
```
public/locales/
â”œâ”€â”€ fa/
â”‚   â”œâ”€â”€ common.json
â”‚   â”œâ”€â”€ water.json
â”‚   â””â”€â”€ energy.json
â””â”€â”€ en/
    â”œâ”€â”€ common.json
    â”œâ”€â”€ water.json
    â””â”€â”€ energy.json
```

#### ğŸ”„ Real-time Collaboration

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Supabase Realtime subscriptions
- [ ] Multi-user editing
- [ ] Live cursors
- [ ] Comments & annotations
- [ ] Version history

**Ù…Ø«Ø§Ù„:**
```javascript
// Real-time scenario updates
const subscription = supabase
  .channel('scenarios')
  .on('postgres_changes', {
    event: 'UPDATE',
    schema: 'public',
    table: 'scenarios',
    filter: `id=eq.${scenarioId}`
  }, (payload) => {
    console.log('Scenario updated:', payload.new);
    updateUI(payload.new);
  })
  .subscribe();
```

### Priority 4 (Ø¢ÛŒÙ†Ø¯Ù‡ Ø¯ÙˆØ±)

#### ğŸ“± Mobile App

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] React Native app
- [ ] Capacitor/Ionic
- [ ] Native features (camera, GPS)
- [ ] App Store deployment
- [ ] Push notifications

#### ğŸ§ª Advanced Testing

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Jest unit tests (80% coverage)
- [ ] Cypress E2E tests
- [ ] Visual regression tests (Percy/Chromatic)
- [ ] Performance benchmarks
- [ ] Load testing

#### ğŸ—ï¸ Microservices Architecture

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ API Ø¨Ù‡ microservices
- [ ] Docker containerization
- [ ] Kubernetes deployment
- [ ] Message queue (RabbitMQ)
- [ ] API Gateway

#### ğŸ” Advanced Search

**Ú©Ø§Ø±Ù‡Ø§:**
- [ ] Elasticsearch/Algolia integration
- [ ] Full-text search
- [ ] Fuzzy matching
- [ ] Autocomplete
- [ ] Search analytics

---

## ğŸ“š Ù…Ù†Ø§Ø¨Ø¹ Ùˆ Ù…Ø±Ø§Ø¬Ø¹

### Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø¯Ø§Ø®Ù„ÛŒ

- [README.md](./README.md) - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø´Ø±ÙˆØ¹ Ø³Ø±ÛŒØ¹
- [API_DOCUMENTATION.md](./API_DOCUMENTATION.md) - Ù…Ø³ØªÙ†Ø¯Ø§Øª API
- [DEPLOYMENT.md](./DEPLOYMENT.md) - Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Deployment
- [ARCHITECTURE.md](./ARCHITECTURE.md) - Ù…Ø¹Ù…Ø§Ø±ÛŒ CLD
- [PERFORMANCE_OPTIMIZATIONS.md](./docs/PERFORMANCE_OPTIMIZATIONS.md)
- [IMPROVEMENTS.md](./docs/amaayesh/IMPROVEMENTS.md)

### Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø®Ø§Ø±Ø¬ÛŒ

**Frontend:**
- [Next.js Docs](https://nextjs.org/docs)
- [React Docs](https://react.dev)
- [Tailwind CSS](https://tailwindcss.com/docs)
- [Radix UI](https://www.radix-ui.com)

**Visualization:**
- [Cytoscape.js](https://js.cytoscape.org)
- [Leaflet.js](https://leafletjs.com)
- [Chart.js](https://www.chartjs.org)

**Backend:**
- [FastAPI](https://fastapi.tiangolo.com)
- [Netlify Functions](https://docs.netlify.com/functions/overview/)
- [Supabase](https://supabase.com/docs)

**Performance:**
- [Web Vitals](https://web.dev/vitals/)
- [Lighthouse](https://developer.chrome.com/docs/lighthouse/)

### Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ Ùˆ Ù…Ù‚Ø§Ù„Ø§Øª

- **"Designing Data-Intensive Applications"** - Martin Kleppmann
- **"High Performance Browser Networking"** - Ilya Grigorik
- **"JavaScript: The Good Parts"** - Douglas Crockford
- **Web.dev Performance** - Google

### Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…ÙÛŒØ¯

**Development:**
- VS Code + Extensions
- Chrome DevTools
- Postman/Insomnia (API testing)

**Performance:**
- Lighthouse CI
- WebPageTest
- Chrome User Experience Report

**Monitoring:**
- Vercel Analytics
- Cloudflare Analytics
- Sentry (Error tracking)

---

## ğŸ‘¥ Ù…Ø´Ø§Ø±Ú©Øª Ùˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

### Ù†Ø­ÙˆÙ‡ Ù…Ø´Ø§Ø±Ú©Øª

1. Fork repository
2. Create feature branch
3. Commit changes
4. Push to branch
5. Create Pull Request

**Code Style:**
- Follow existing patterns
- Write tests
- Update documentation
- Use conventional commits

**Commit Messages:**
```
feat: add new feature
fix: resolve bug
docs: update documentation
style: formatting changes
refactor: code restructuring
test: add tests
chore: maintenance tasks
```

### Ú¯Ø²Ø§Ø±Ø´ Ù…Ø´Ú©Ù„Ø§Øª

**GitHub Issues:**
- https://github.com/sajjadzea/zero-day-of-water2/issues

**Template:**
```markdown
## Description
ØªÙˆØ¶ÛŒØ­ Ù…Ø´Ú©Ù„

## Steps to Reproduce
1. ...
2. ...
3. ...

## Expected Behavior
Ø±ÙØªØ§Ø± Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±

## Actual Behavior
Ø±ÙØªØ§Ø± ÙˆØ§Ù‚Ø¹ÛŒ

## Environment
- Browser: Chrome 120
- OS: Windows 11
- Version: 1.0.0

## Screenshots
(Ø§Ú¯Ø± Ù…Ù‚ØªØ¶ÛŒ Ø§Ø³Øª)
```

### Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ

**Email:** support@wesh360.ir
**Website:** https://wesh360.ir
**GitHub:** https://github.com/sajjadzea/zero-day-of-water2

---

## ğŸ“„ Ù…Ø¬ÙˆØ²

**License:** MIT

```
MIT License

Copyright (c) 2025 wesh360.ir

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

---

## ğŸ™ ØªØ´Ú©Ø± Ùˆ Ù‚Ø¯Ø±Ø¯Ø§Ù†ÛŒ

Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ Ø§Ø² Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ Ùˆ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ù…ØªÙ†â€ŒØ¨Ø§Ø² Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯:

- **Next.js** - Vercel
- **React** - Meta
- **Tailwind CSS** - Tailwind Labs
- **Cytoscape.js** - Cytoscape Consortium
- **Leaflet.js** - Vladimir Agafonkin
- **Supabase** - Supabase Inc.
- **FastAPI** - SebastiÃ¡n RamÃ­rez
- Ùˆ Ø¯ÛŒÚ¯Ø± Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ø§Ù„ÛŒ...

Ù‡Ù…Ú†Ù†ÛŒÙ† Ø§Ø² Ù‡Ù…Ù‡ Ú©Ø³Ø§Ù†ÛŒ Ú©Ù‡ Ø¯Ø± Ø¨Ù‡Ø¨ÙˆØ¯ Ø§ÛŒÙ† Ù¾Ø±ÙˆÚ˜Ù‡ Ù…Ø´Ø§Ø±Ú©Øª Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯ØŒ ØªØ´Ú©Ø± Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….

---

## ğŸ“ ØªÙ…Ø§Ø³ Ø¨Ø§ Ù…Ø§

**ÙˆØ¨Ø³Ø§ÛŒØª:** https://wesh360.ir
**Ø§ÛŒÙ…ÛŒÙ„:** info@wesh360.ir
**GitHub:** https://github.com/sajjadzea/zero-day-of-water2
**Ù…Ø³ØªÙ†Ø¯Ø§Øª:** https://wesh360.ir/docs

---

**Ù†Ø³Ø®Ù‡ Ù…Ø³ØªÙ†Ø¯Ø§Øª:** 1.0.0
**Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:** Û±Û´Û°Û³/Û±Û±/Û±Û¶
**Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡:** ØªÛŒÙ… wesh360.ir
**ÙˆØ¶Ø¹ÛŒØª:** âœ… Ú©Ø§Ù…Ù„ Ùˆ Ø¨Ù‡â€ŒØ±ÙˆØ²
